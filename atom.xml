<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Platypus&#39;s Blog</title>
  <icon>https://www.gravatar.com/avatar/dbe80e8cde95267c6e860f201a20e462</icon>
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://platypuspro.github.io/"/>
  <updated>2015-06-27T12:09:52.000Z</updated>
  <id>http://platypuspro.github.io/</id>
  
  <author>
    <name>Platypus</name>
    <email>1293705262@qq.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>BZOJ 3122</title>
    <link href="http://platypuspro.github.io/posts/bzoj-3122/"/>
    <id>http://platypuspro.github.io/posts/bzoj-3122/</id>
    <published>2015-06-27T11:44:41.000Z</published>
    <updated>2015-06-27T12:09:52.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=3122" target="_blank" rel="noopener">传送门</a></p><p>先判断$x$是否等于$t$</p><p>若$a=0$，判断$b$是否等于$t$</p><p>若$a=1$，$X_n=X_1+(n-1)b\ ({\rm mod}\ p)$</p><p>设$x=n-1$，原式变为$bx+py=t-X_1\ ({\rm mod}\ p)$，直接${\rm exgcd}$解$x$</p><p>对于剩下的正常情况呢…</p><p>$$X_n=a^{n-1}X_1+b\frac{a^{n-1}-1}{a-1}\ ({\rm mod}\ p)$$</p><p>设$c$为$a-1$在${\rm mod}\ p$意义下的逆元</p><p>$$a^{n-1}(X_1+bc)=t+bc({\rm mod}\ p)$$</p><p>$$(X_1+bc)a^{n-1}+py=t+bc$$</p><p>拿${\rm exgcd}$解出$a^{n-1}$，然后再用${\rm BSGS}$算一下$n-1$</p><p>需要注意${\rm exgcd}$里面可能会出现负数</p><p><del>™我的hash又冲突</del></p><p><i class="fa fa-code fa-2x"></i><br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">program</span> bzoj_3122;</span><br><span class="line"><span class="keyword">const</span> mo=<span class="number">100007</span>;</span><br><span class="line">      e=<span class="number">31</span>;</span><br><span class="line"><span class="keyword">var</span> p,a,b,x1,t,n,i:longint;</span><br><span class="line">    h:<span class="keyword">array</span>[<span class="number">0</span>..mo,<span class="number">1</span>..<span class="number">2</span>]<span class="keyword">of</span> <span class="keyword">record</span> k,i:longint; <span class="keyword">end</span>;</span><br><span class="line">    cnt:<span class="keyword">array</span>[<span class="number">0</span>..mo]<span class="keyword">of</span> longint;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mul</span><span class="params">(a,b:longint)</span>:</span>longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  mul:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> b&gt;<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> b <span class="keyword">and</span> <span class="number">1</span>=<span class="number">1</span> <span class="keyword">then</span> mul:=(mul+a)<span class="keyword">mod</span> p;</span><br><span class="line">    a:=a&lt;&lt;<span class="number">1</span> <span class="keyword">mod</span> p;</span><br><span class="line">    b:=b&gt;&gt;<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">qpower</span><span class="params">(x,k:longint)</span>:</span>longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  qpower:=<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> k&gt;<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> k <span class="keyword">and</span> <span class="number">1</span>=<span class="number">1</span> <span class="keyword">then</span> qpower:=mul(qpower,x);</span><br><span class="line">    x:=mul(x,x);</span><br><span class="line">    k:=k&gt;&gt;<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">exgcd</span><span class="params">(a,b:longint;<span class="keyword">var</span> x,y:longint)</span>:</span>longint;</span><br><span class="line"><span class="keyword">var</span> t:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">if</span> b=<span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    x:=<span class="number">1</span>;</span><br><span class="line">    y:=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">exit</span>(a);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  exgcd:=exgcd(b,a <span class="keyword">mod</span> b,x,y);</span><br><span class="line">  t:=x;</span><br><span class="line">  x:=y;</span><br><span class="line">  y:=t-a <span class="keyword">div</span> b*y;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">solve</span><span class="params">(a,b,c:longint)</span>:</span>longint;</span><br><span class="line"><span class="keyword">var</span> g,x,y:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">if</span> c&lt;<span class="number">0</span> <span class="keyword">then</span> c:=c <span class="keyword">mod</span> p+p;</span><br><span class="line">  g:=exgcd(a,b,x,y);</span><br><span class="line">  <span class="keyword">if</span> c <span class="keyword">mod</span> g&lt;&gt;<span class="number">0</span> <span class="keyword">then</span> <span class="keyword">exit</span>(-<span class="number">2</span>);</span><br><span class="line">  <span class="keyword">if</span> x&lt;<span class="number">0</span> <span class="keyword">then</span> x:=x <span class="keyword">mod</span> p+p;</span><br><span class="line">  <span class="keyword">exit</span>(mul(x,(c <span class="keyword">div</span> g)));</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hash</span><span class="params">(x:longint)</span>:</span>longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  hash:=<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> x&gt;<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    hash:=(hash*e <span class="keyword">mod</span> mo+x <span class="keyword">mod</span> <span class="number">10</span>)<span class="keyword">mod</span> mo;</span><br><span class="line">    x:=x <span class="keyword">div</span> <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">BSGS</span><span class="params">(x,y:longint)</span>:</span>longint;</span><br><span class="line"><span class="keyword">var</span> m,i,j,s,inv,xx,hs:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  m:=trunc(sqrt(p)+<span class="number">1</span>-(<span class="number">1</span>e-<span class="number">6</span>));</span><br><span class="line">  s:=<span class="number">1</span>;</span><br><span class="line">  fillchar(cnt,sizeof(cnt),<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> m-<span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    hs:=hash(s);</span><br><span class="line">    inc(cnt[hs]);</span><br><span class="line">    h[hs,cnt[hs]].i:=i;</span><br><span class="line">    h[hs,cnt[hs]].k:=s;</span><br><span class="line">    s:=mul(s,x);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  inv:=qpower(x,p-m-<span class="number">1</span>);</span><br><span class="line">  xx:=y;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> m-<span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    hs:=hash(xx);</span><br><span class="line">    <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> cnt[hs] <span class="keyword">do</span> <span class="keyword">if</span> h[hs,j].k=xx <span class="keyword">then</span> <span class="keyword">exit</span>(i*m+h[hs,j].i);</span><br><span class="line">    xx:=mul(xx,inv);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">exit</span>(-<span class="number">2</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calc</span>:</span>longint;</span><br><span class="line"><span class="keyword">var</span> c,a_:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">if</span> x1=t <span class="keyword">then</span> <span class="keyword">exit</span>(<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">if</span> a=<span class="number">0</span> <span class="keyword">then</span> <span class="keyword">if</span> b=t <span class="keyword">then</span> <span class="keyword">exit</span>(<span class="number">2</span>) <span class="keyword">else</span> <span class="keyword">exit</span>(-<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">if</span> a=<span class="number">1</span> <span class="keyword">then</span> <span class="keyword">exit</span>(solve(b,p,t-x1)+<span class="number">1</span>);</span><br><span class="line">  c:=qpower(a-<span class="number">1</span>,p-<span class="number">2</span>);</span><br><span class="line">  a_:=solve((x1+mul(b,c))<span class="keyword">mod</span> p,p,(t+mul(b,c))<span class="keyword">mod</span> p);</span><br><span class="line">  <span class="keyword">exit</span>(BSGS(a,a_)+<span class="number">1</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  readln(n);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    readln(p,a,b,x1,t);</span><br><span class="line">    writeln(calc);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;a href=&quot;http://www.lydsy.com/JudgeOnline/problem.php?id=3122&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;传送门&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;先判断$x$是否等于
      
    
    </summary>
    
      <category term="BZOJ" scheme="http://platypuspro.github.io/categories/BZOJ/"/>
    
    
      <category term="Math" scheme="http://platypuspro.github.io/tags/Math/"/>
    
  </entry>
  
  <entry>
    <title>BZOJ 3262</title>
    <link href="http://platypuspro.github.io/posts/bzoj-3262/"/>
    <id>http://platypuspro.github.io/posts/bzoj-3262/</id>
    <published>2015-06-26T09:20:56.000Z</published>
    <updated>2015-06-26T10:29:44.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=3262" target="_blank" rel="noopener">不稳定的传送门</a></p><p><del>感觉整个人都CDQ了…尼玛这么多维闹哪样啊</del></p><p>对第一维进行排序然后扔掉，问题变成了<strong>依次</strong>向一个$k\times k$的矩阵中插入$n$个点，每次插入时需统计横纵坐标均$\leq$该点坐标的点数，这样一个三维无序的问题变成了一个二维有序的问题</p><p>然后对于这个问题，直接CDQ分治，每次$solve(l,r)$中统计$[l,mid]$对$[mid+1,r]$造成的影响，然后继续递归处理$[l,mid],[mid+1,r]$</p><p>因为题意是三个恶心的$\leq$，所以要把一样的花合在一起存…</p><p><i class="fa fa-code fa-2x"></i><br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">program</span> bzoj_3262;</span><br><span class="line"><span class="keyword">type</span> flower=<span class="keyword">record</span> s,c,m,id,ans,cnt:longint; <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">var</span> n,i,tot,m:longint;</span><br><span class="line">    f,swp:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">100000</span>]<span class="keyword">of</span> flower;</span><br><span class="line">    bit,cnt:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">200000</span>]<span class="keyword">of</span> longint;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">swap</span><span class="params">(<span class="keyword">var</span> a,b:flower)</span>;</span></span><br><span class="line"><span class="keyword">var</span> p:flower;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  p:=a;</span><br><span class="line">  a:=b;</span><br><span class="line">  b:=p;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cmp</span><span class="params">(a,b:flower;flag:boolean)</span>:</span>boolean;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">if</span> flag <span class="keyword">and</span>(a.s&lt;&gt;b.s) <span class="keyword">then</span> <span class="keyword">exit</span>(a.s&lt;b.s);</span><br><span class="line">  <span class="keyword">if</span> a.c&lt;&gt;b.c <span class="keyword">then</span> <span class="keyword">exit</span>(a.c&lt;b.c);</span><br><span class="line">  <span class="keyword">exit</span>(a.m&lt;b.m);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">diff</span><span class="params">(a,b:flower)</span>:</span>boolean;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">exit</span>((a.s&lt;&gt;b.s)<span class="keyword">or</span>(a.c&lt;&gt;b.c)<span class="keyword">or</span>(a.m&lt;&gt;b.m));</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">qsort</span><span class="params">(l,r:longint;flag:boolean)</span>;</span></span><br><span class="line"><span class="keyword">var</span> i,j:longint;</span><br><span class="line">    mid:flower;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  i:=l;</span><br><span class="line">  j:=r;</span><br><span class="line">  mid:=f[(l+r)&gt;&gt;<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">repeat</span></span><br><span class="line">    <span class="keyword">while</span> cmp(f[i],mid,flag) <span class="keyword">do</span> inc(i);</span><br><span class="line">    <span class="keyword">while</span> cmp(mid,f[j],flag) <span class="keyword">do</span> dec(j);</span><br><span class="line">    <span class="keyword">if</span> i&lt;=j <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      swap(f[i],f[j]);</span><br><span class="line">      inc(i);</span><br><span class="line">      dec(j);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">until</span> i&gt;j;</span><br><span class="line">  <span class="keyword">if</span> l&lt;j <span class="keyword">then</span> qsort(l,j,flag);</span><br><span class="line">  <span class="keyword">if</span> i&lt;r <span class="keyword">then</span> qsort(i,r,flag);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">modify</span><span class="params">(p,d:longint)</span>;</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">while</span> p&lt;=m <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    inc(bit[p],d);</span><br><span class="line">    inc(p,p <span class="keyword">and</span> -p);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">query</span><span class="params">(p:longint)</span>:</span>longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  query:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> p&gt;<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    inc(query,bit[p]);</span><br><span class="line">    dec(p,p <span class="keyword">and</span> -p);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">solve</span><span class="params">(l,r:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> l1,l2,mid,i,j:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">if</span> l&gt;=r <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    inc(f[l].ans,f[l].cnt-<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  mid:=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">  l1:=l-<span class="number">1</span>;</span><br><span class="line">  l2:=mid;</span><br><span class="line">  <span class="keyword">for</span> i:=l <span class="keyword">to</span> r <span class="keyword">do</span> <span class="keyword">if</span> f[i].id&lt;=mid <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    inc(l1);</span><br><span class="line">    swp[l1]:=f[i];</span><br><span class="line">  <span class="keyword">end</span> <span class="keyword">else</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    inc(l2);</span><br><span class="line">    swp[l2]:=f[i];</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=l <span class="keyword">to</span> r <span class="keyword">do</span> f[i]:=swp[i];</span><br><span class="line">  j:=l;</span><br><span class="line">  <span class="keyword">for</span> i:=mid+<span class="number">1</span> <span class="keyword">to</span> r <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">while</span> (j&lt;=mid)<span class="keyword">and</span>(f[j].c&lt;=f[i].c) <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      modify(f[j].m,f[j].cnt);</span><br><span class="line">      inc(j);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    inc(f[i].ans,query(f[i].m));</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=l <span class="keyword">to</span> j-<span class="number">1</span> <span class="keyword">do</span> modify(f[i].m,-f[i].cnt);</span><br><span class="line">  solve(l,mid);</span><br><span class="line">  solve(mid+<span class="number">1</span>,r);</span><br><span class="line">  l1:=l;</span><br><span class="line">  l2:=mid+<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=l <span class="keyword">to</span> r <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">if</span> (l1&lt;=mid)<span class="keyword">and</span>(cmp(f[l1],f[l2],false))<span class="keyword">or</span>(l2&gt;r) <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    swp[i]:=f[l1];</span><br><span class="line">    inc(l1);</span><br><span class="line">  <span class="keyword">end</span> <span class="keyword">else</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    swp[i]:=f[l2];</span><br><span class="line">    inc(l2);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=l <span class="keyword">to</span> r <span class="keyword">do</span> f[i]:=swp[i];</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  readln(n,m);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">with</span> f[i] <span class="keyword">do</span> readln(s,c,m);</span><br><span class="line">  qsort(<span class="number">1</span>,n,true);</span><br><span class="line">  tot:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">if</span> (i=<span class="number">1</span>)<span class="keyword">or</span>(diff(f[tot],f[i])) <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    inc(tot);</span><br><span class="line">    f[tot]:=f[i];</span><br><span class="line">    f[tot].cnt:=<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">end</span> <span class="keyword">else</span> inc(f[tot].cnt);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> tot <span class="keyword">do</span> f[i].id:=i;</span><br><span class="line">  qsort(<span class="number">1</span>,tot,false);</span><br><span class="line">  solve(<span class="number">1</span>,tot);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> tot <span class="keyword">do</span> inc(cnt[f[i].ans],f[i].cnt);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> n-<span class="number">1</span> <span class="keyword">do</span> writeln(cnt[i]);</span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;a href=&quot;http://www.lydsy.com/JudgeOnline/problem.php?id=3262&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;不稳定的传送门&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;del&gt;感
      
    
    </summary>
    
      <category term="BZOJ" scheme="http://platypuspro.github.io/categories/BZOJ/"/>
    
    
      <category term="Divide and Conquer" scheme="http://platypuspro.github.io/tags/Divide-and-Conquer/"/>
    
  </entry>
  
  <entry>
    <title>BZOJ 2823</title>
    <link href="http://platypuspro.github.io/posts/bzoj-2823/"/>
    <id>http://platypuspro.github.io/posts/bzoj-2823/</id>
    <published>2015-06-25T12:37:10.000Z</published>
    <updated>2015-06-25T12:42:00.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=2823" target="_blank" rel="noopener">传送门</a></p><p>嗯复习一下随机增量…</p><p>先${\rm shuffle}$一下，然后每次挑一个圆外的点加进来</p><p><del>公示推错QAQ</del></p><p>傻逼<code>extended</code>连四舍五入都不会<del>你吃*去吧</del> 只能用<code>double</code></p><p><i class="fa fa-code fa-2x"></i><br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">program</span> bzoj_2823;</span><br><span class="line"><span class="keyword">const</span> eps=<span class="number">1</span>e-<span class="number">6</span>;</span><br><span class="line"><span class="keyword">type</span> point=<span class="keyword">record</span> x,y:double; <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">var</span> p:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">1000000</span>]<span class="keyword">of</span> point;</span><br><span class="line">    n,i,j,k:longint;</span><br><span class="line">    o:point;</span><br><span class="line">    r:double;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">swap</span><span class="params">(<span class="keyword">var</span> a,b:point)</span>;</span></span><br><span class="line"><span class="keyword">var</span> p:point;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  p:=a;</span><br><span class="line">  a:=b;</span><br><span class="line">  b:=p;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dis</span><span class="params">(a,b:point)</span>:</span>double;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">exit</span>(sqrt(sqr(a.x-b.x)+sqr(a.y-b.y)));</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">calc</span><span class="params">(a,b,c:point)</span>;</span></span><br><span class="line"><span class="keyword">var</span> k1,k2,b1,b2:double;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  k1:=(b.x-a.x)/(a.y-b.y);</span><br><span class="line">  k2:=(c.x-b.x)/(b.y-c.y);</span><br><span class="line">  b1:=(a.x*a.x-b.x*b.x+a.y*a.y-b.y*b.y)/(<span class="number">2</span>*(a.y-b.y));</span><br><span class="line">  b2:=(b.x*b.x-c.x*c.x+b.y*b.y-c.y*c.y)/(<span class="number">2</span>*(b.y-c.y));</span><br><span class="line">  o.x:=(b2-b1)/(k1-k2);</span><br><span class="line">  o.y:=(k2*b1-k1*b2)/(k2-k1);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  randomize;</span><br><span class="line">  readln(n);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> readln(p[i].x,p[i].y);</span><br><span class="line">  <span class="keyword">for</span> i:=n <span class="keyword">downto</span> <span class="number">2</span> <span class="keyword">do</span> swap(p[i],p[random(i-<span class="number">1</span>)+<span class="number">1</span>]);</span><br><span class="line">  o:=p[<span class="number">1</span>];</span><br><span class="line">  r:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">2</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">if</span> dis(p[i],o)&gt;r+eps <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    o:=p[i];</span><br><span class="line">    r:=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> i-<span class="number">1</span> <span class="keyword">do</span> <span class="keyword">if</span> dis(o,p[j])&gt;r+eps <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      o.x:=(p[i].x+p[j].x)/<span class="number">2</span>;</span><br><span class="line">      o.y:=(p[i].y+p[j].y)/<span class="number">2</span>;</span><br><span class="line">      r:=dis(o,p[j]);</span><br><span class="line">      <span class="keyword">for</span> k:=<span class="number">1</span> <span class="keyword">to</span> j-<span class="number">1</span> <span class="keyword">do</span> <span class="keyword">if</span> dis(o,p[k])&gt;r+eps <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">begin</span></span><br><span class="line">        calc(p[i],p[j],p[k]);</span><br><span class="line">        r:=dis(p[k],o);</span><br><span class="line">      <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  writeln(o.x:<span class="number">0</span>:<span class="number">2</span>,<span class="string">' '</span>,o.y:<span class="number">0</span>:<span class="number">2</span>,<span class="string">' '</span>,r:<span class="number">0</span>:<span class="number">2</span>);</span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;a href=&quot;http://www.lydsy.com/JudgeOnline/problem.php?id=2823&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;传送门&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;嗯复习一下随机增量…
      
    
    </summary>
    
      <category term="BZOJ" scheme="http://platypuspro.github.io/categories/BZOJ/"/>
    
    
      <category term="Random Incremental" scheme="http://platypuspro.github.io/tags/Random-Incremental/"/>
    
  </entry>
  
  <entry>
    <title>BZOJ 2618</title>
    <link href="http://platypuspro.github.io/posts/bzoj-2618/"/>
    <id>http://platypuspro.github.io/posts/bzoj-2618/</id>
    <published>2015-06-23T13:01:39.000Z</published>
    <updated>2015-06-23T13:46:06.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=2618" target="_blank" rel="noopener">传送门</a></p><p>坑B<code>extended</code>啊啊啊啊啊啊啊凭什么一样的公式算出来的东西还是会有误差啊啊啊啊啊啊</p><p>嗯…$n\times m$个半平面求交…没了</p><p>PASCAL没有高端的<code>atan2</code>，只能<code>arctan</code>完特判一下…</p><p><i class="fa fa-code fa-2x"></i><br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">program</span> bzoj_2618;</span><br><span class="line"><span class="keyword">uses</span> math;</span><br><span class="line"><span class="keyword">const</span> eps=<span class="number">1</span>e-<span class="number">6</span>;</span><br><span class="line"><span class="keyword">type</span> point=<span class="keyword">record</span> x,y:extended; <span class="keyword">end</span>;</span><br><span class="line">     line=<span class="keyword">record</span> a,b:point; k:extended; <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">var</span> p:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">500</span>]<span class="keyword">of</span> point;</span><br><span class="line">    l,s:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">500</span>]<span class="keyword">of</span> line;</span><br><span class="line">    n,m,i,j,tot:longint;</span><br><span class="line">    ans:extended;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">l_</span><span class="params">(a,b:point)</span>:</span>line;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  l_.a:=a;</span><br><span class="line">  l_.b:=b;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cross</span><span class="params">(l1,l2:line)</span>:</span>extended;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">exit</span>((l1.b.x-l1.a.x)*(l2.b.y-l2.a.y)-(l2.b.x-l2.a.x)*(l1.b.y-l1.a.y));</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cmp</span><span class="params">(l1,l2:line)</span>:</span>boolean;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">if</span> abs(l1.k-l2.k)&gt;eps <span class="keyword">then</span> <span class="keyword">exit</span>(l1.k&lt;l2.k);</span><br><span class="line">  <span class="keyword">exit</span>(cross(l1,l_(l1.a,l2.b))&gt;<span class="number">0</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">qsort</span><span class="params">(ll,rr:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> i,j:longint;</span><br><span class="line">    mid,p:line;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  i:=ll;</span><br><span class="line">  j:=rr;</span><br><span class="line">  mid:=l[(ll+rr)&gt;&gt;<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">repeat</span></span><br><span class="line">    <span class="keyword">while</span> cmp(l[i],mid) <span class="keyword">do</span> inc(i);</span><br><span class="line">    <span class="keyword">while</span> cmp(mid,l[j]) <span class="keyword">do</span> dec(j);</span><br><span class="line">    <span class="keyword">if</span> i&lt;=j <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      p:=l[i];</span><br><span class="line">      l[i]:=l[j];</span><br><span class="line">      l[j]:=p;</span><br><span class="line">      inc(i);</span><br><span class="line">      dec(j);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">until</span> i&gt;j;</span><br><span class="line">  <span class="keyword">if</span> ll&lt;j <span class="keyword">then</span> qsort(ll,j);</span><br><span class="line">  <span class="keyword">if</span> i&lt;rr <span class="keyword">then</span> qsort(i,rr);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">unique</span>;</span></span><br><span class="line"><span class="keyword">var</span> cnt,i:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  qsort(<span class="number">1</span>,tot);</span><br><span class="line">  cnt:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> tot <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (i=<span class="number">1</span>)<span class="keyword">or</span>(l[i].k-l[i-<span class="number">1</span>].k&gt;eps) <span class="keyword">then</span> inc(cnt);</span><br><span class="line">    l[cnt]:=l[i];</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  tot:=cnt;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inter</span><span class="params">(l1,l2:line)</span>:</span>point;</span><br><span class="line"><span class="keyword">var</span> s1,s2,t:extended;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  s1:=cross(l1,l_(l1.a,l2.a));</span><br><span class="line">  s2:=cross(l_(l1.a,l2.b),l1);</span><br><span class="line">  t:=s1/(s1+s2+eps);</span><br><span class="line">  inter.x:=l2.a.x+t*(l2.b.x-l2.a.x);</span><br><span class="line">  inter.y:=l2.a.y+t*(l2.b.y-l2.a.y);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upper</span><span class="params">(p:point;l:line)</span>:</span>boolean;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">exit</span>(cross(l,l_(l.a,p))-eps&gt;<span class="number">0</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">solve</span>;</span></span><br><span class="line"><span class="keyword">var</span> ll,rr,i:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  s[<span class="number">1</span>]:=l[<span class="number">1</span>];</span><br><span class="line">  s[<span class="number">2</span>]:=l[<span class="number">2</span>];</span><br><span class="line">  ll:=<span class="number">1</span>;</span><br><span class="line">  rr:=<span class="number">2</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">3</span> <span class="keyword">to</span> tot <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">while</span> (ll&lt;rr)<span class="keyword">and</span>(<span class="keyword">not</span> upper(inter(s[rr-<span class="number">1</span>],s[rr]),l[i])) <span class="keyword">do</span> dec(rr);</span><br><span class="line">    <span class="keyword">while</span> (ll&lt;rr)<span class="keyword">and</span>(<span class="keyword">not</span> upper(inter(s[ll],s[ll+<span class="number">1</span>]),l[i])) <span class="keyword">do</span> inc(ll);</span><br><span class="line">    inc(rr);</span><br><span class="line">    s[rr]:=l[i];</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">while</span> (ll&lt;rr)<span class="keyword">and</span>(<span class="keyword">not</span> upper(inter(s[rr-<span class="number">1</span>],s[rr]),s[ll])) <span class="keyword">do</span> dec(rr);</span><br><span class="line">  <span class="keyword">while</span> (ll&lt;rr)<span class="keyword">and</span>(<span class="keyword">not</span> upper(inter(s[ll],s[ll+<span class="number">1</span>]),s[rr])) <span class="keyword">do</span> inc(ll);</span><br><span class="line">  n:=rr-ll+<span class="number">1</span>;</span><br><span class="line">  s[rr+<span class="number">1</span>]:=s[ll];</span><br><span class="line">  <span class="keyword">for</span> i:=ll <span class="keyword">to</span> rr <span class="keyword">do</span> p[i-ll+<span class="number">1</span>]:=inter(s[i],s[i+<span class="number">1</span>]);</span><br><span class="line">  ans:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">2</span> <span class="keyword">to</span> n-<span class="number">1</span> <span class="keyword">do</span> ans:=ans+cross(l_(p[<span class="number">1</span>],p[i]),l_(p[<span class="number">1</span>],p[i+<span class="number">1</span>]))/<span class="number">2</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  readln(n);</span><br><span class="line">  tot:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    readln(m);</span><br><span class="line">    <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span> readln(p[j].x,p[j].y);</span><br><span class="line">    p[m+<span class="number">1</span>]:=p[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      l[tot+j].a:=p[j];</span><br><span class="line">      l[tot+j].b:=p[j+<span class="number">1</span>];</span><br><span class="line">      l[tot+j].k:=arctan((p[j+<span class="number">1</span>].y-p[j].y)/(p[j+<span class="number">1</span>].x-p[j].x+eps));</span><br><span class="line">      <span class="keyword">if</span> (p[j].x&gt;p[j+<span class="number">1</span>].x)<span class="keyword">and</span>(p[j].y&lt;=p[j+<span class="number">1</span>].y) <span class="keyword">then</span> l[tot+j].k:=pi+l[tot+j].k;</span><br><span class="line">      <span class="keyword">if</span> (p[j].x&gt;p[j+<span class="number">1</span>].x)<span class="keyword">and</span>(p[j].y&gt;p[j+<span class="number">1</span>].y) <span class="keyword">then</span> l[tot+j].k:=-pi+l[tot+j].k;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    inc(tot,m);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  unique;</span><br><span class="line">  solve;</span><br><span class="line">  writeln(ans:<span class="number">0</span>:<span class="number">3</span>);</span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;a href=&quot;http://www.lydsy.com/JudgeOnline/problem.php?id=2618&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;传送门&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;坑B&lt;code&gt;ex
      
    
    </summary>
    
      <category term="BZOJ" scheme="http://platypuspro.github.io/categories/BZOJ/"/>
    
    
      <category term="Half-Plane Intersection" scheme="http://platypuspro.github.io/tags/Half-Plane-Intersection/"/>
    
  </entry>
  
  <entry>
    <title>BZOJ 1038</title>
    <link href="http://platypuspro.github.io/posts/bzoj-1038/"/>
    <id>http://platypuspro.github.io/posts/bzoj-1038/</id>
    <published>2015-06-23T13:01:34.000Z</published>
    <updated>2015-06-23T13:39:14.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=1038" target="_blank" rel="noopener">传送门</a></p><p>先贴一发<a href="http://wenku.baidu.com/view/c750720bf78a6529647d53ae.html" target="_blank" rel="noopener">zzy的论文</a> Orz</p><p>姿势大概是这样：</p><ul><li>将所有半平面按极角排序</li><li>多个极角相同的半平面只保留一个，就是那个限制的范围最小的</li><li>维护一个栈，栈内是个凸壳或凸多边形，每次往里加边的时候剔除栈中不在限制范围内的边。若是凸壳，一个栈就够了，若是凸多边形就需要双端队列了，因为后加的边可能会覆盖最开始加的</li><li>如果需要，将栈中所有边求交</li></ul><p>拿计算几何实现的时候细节好多 = =</p><p>求两直线交点时可以直接拿叉积+定比分点公式搞，或拿解析式算 <del>据说前一种适用范围广一点？</del></p><p>这道题的最优解只可能出现在凸壳的顶点或山顶，这时上下各有一个点集和一个边集，搞完凸壳以后枚举一下就能得出答案</p><p>刚开始我是枚举点集中的点和边集中的边，但是这样会出现各种奇怪的错误…因为有些边的端点并不属于点集然后blabla答案就错了 <del>啊扯得好乱</del></p><p>所以只能枚举点集和另外一个点集</p><p>还有就是记得加上边界，数据中有最优解在最边上山顶的情况</p><p><i class="fa fa-code fa-2x"></i><br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">program</span> bzoj_1038;</span><br><span class="line"><span class="keyword">const</span> eps=<span class="number">1</span>e-<span class="number">10</span>;</span><br><span class="line"><span class="keyword">type</span> point=<span class="keyword">record</span> x,y:extended; <span class="keyword">end</span>;</span><br><span class="line">     line=<span class="keyword">record</span> a,b:point; k:extended; <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">var</span> n,m,i,tot:longint;</span><br><span class="line">    p,q:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">301</span>]<span class="keyword">of</span> point;</span><br><span class="line">    l,s:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">300</span>]<span class="keyword">of</span> line;</span><br><span class="line">    ans:extended;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">qsort</span><span class="params">(ll,rr:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> i,j:longint;</span><br><span class="line">    mid,p:line;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  i:=ll;</span><br><span class="line">  j:=rr;</span><br><span class="line">  mid:=l[(ll+rr)&gt;&gt;<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">repeat</span></span><br><span class="line">    <span class="keyword">while</span> l[i].k&lt;mid.k-eps <span class="keyword">do</span> inc(i);</span><br><span class="line">    <span class="keyword">while</span> l[j].k&gt;mid.k+eps <span class="keyword">do</span> dec(j);</span><br><span class="line">    <span class="keyword">if</span> i&lt;=j <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      p:=l[i];</span><br><span class="line">      l[i]:=l[j];</span><br><span class="line">      l[j]:=p;</span><br><span class="line">      inc(i);</span><br><span class="line">      dec(j);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">until</span> i&gt;j;</span><br><span class="line">  <span class="keyword">if</span> ll&lt;j <span class="keyword">then</span> qsort(ll,j);</span><br><span class="line">  <span class="keyword">if</span> i&lt;rr <span class="keyword">then</span> qsort(i,rr);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">unique</span>;</span></span><br><span class="line"><span class="keyword">var</span> i:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  qsort(<span class="number">2</span>,n);</span><br><span class="line">  tot:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n+<span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (i=<span class="number">1</span>)<span class="keyword">or</span>(abs(l[i].k-l[i-<span class="number">1</span>].k)&gt;eps) <span class="keyword">then</span> inc(tot);</span><br><span class="line">    l[tot]:=l[i];</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">convt</span><span class="params">(a,b:point)</span>:</span>line;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  convt.a:=a;</span><br><span class="line">  convt.b:=b;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cross</span><span class="params">(l1,l2:line)</span>:</span>extended;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">exit</span>((l1.b.x-l1.a.x)*(l2.b.y-l2.a.y)-(l1.b.y-l1.a.y)*(l2.b.x-l2.a.x));</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">inter</span><span class="params">(l1,l2:line)</span>:</span>point;</span><br><span class="line"><span class="keyword">var</span> s1,s2,t:extended;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  s1:=cross(l1,convt(l1.a,l2.a))/<span class="number">2</span>;</span><br><span class="line">  s2:=cross(convt(l1.a,l2.b),l1)/<span class="number">2</span>;</span><br><span class="line">  t:=s1/(s1+s2+eps);</span><br><span class="line">  inter.x:=l2.a.x+t*(l2.b.x-l2.a.x);</span><br><span class="line">  inter.y:=l2.a.y+t*(l2.b.y-l2.a.y);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">upper</span><span class="params">(p:point;l:line)</span>:</span>boolean;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">exit</span>(cross(l,convt(l.a,p))+eps&gt;<span class="number">0</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">solve</span>;</span></span><br><span class="line"><span class="keyword">var</span> top,i,j:longint;</span><br><span class="line">    t:point;</span><br><span class="line">    h:extended;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  s[<span class="number">1</span>]:=l[<span class="number">1</span>];</span><br><span class="line">  s[<span class="number">2</span>]:=l[<span class="number">2</span>];</span><br><span class="line">  top:=<span class="number">2</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">3</span> <span class="keyword">to</span> tot <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">while</span> (top&gt;<span class="number">1</span>)<span class="keyword">and</span>(<span class="keyword">not</span> upper(inter(s[top-<span class="number">1</span>],s[top]),l[i])) <span class="keyword">do</span> dec(top);</span><br><span class="line">    inc(top);</span><br><span class="line">    s[top]:=l[i];</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  m:=top-<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span> q[i]:=inter(s[i],s[i+<span class="number">1</span>]);</span><br><span class="line">  ans:=maxlongint&lt;&lt;<span class="number">32</span>;</span><br><span class="line">  t.y:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> n-<span class="number">1</span> <span class="keyword">do</span> <span class="keyword">if</span> (p[j].x&lt;=q[i].x)<span class="keyword">and</span>(p[j+<span class="number">1</span>].x&gt;=q[i].x) <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    t.x:=q[i].x;</span><br><span class="line">    h:=q[i].y-inter(convt(q[i],t),convt(p[j],p[j+<span class="number">1</span>])).y+eps;</span><br><span class="line">    <span class="keyword">if</span> h&lt;ans <span class="keyword">then</span> ans:=h;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> m-<span class="number">1</span> <span class="keyword">do</span> <span class="keyword">if</span> (q[j].x&lt;=p[i].x)<span class="keyword">and</span>(q[j+<span class="number">1</span>].x&gt;=p[i].x) <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    t.x:=p[i].x;</span><br><span class="line">    h:=inter(convt(p[i],t),convt(q[j],q[j+<span class="number">1</span>])).y-p[i].y+eps;</span><br><span class="line">    <span class="keyword">if</span> h&lt;ans <span class="keyword">then</span> ans:=h;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  readln(n);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">read</span>(p[i].x);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">read</span>(p[i].y);</span><br><span class="line">  p[<span class="number">0</span>].x:=p[<span class="number">1</span>].x;</span><br><span class="line">  p[<span class="number">0</span>].y:=<span class="number">100000</span>;</span><br><span class="line">  p[n+<span class="number">1</span>].x:=p[n].x;</span><br><span class="line">  p[n+<span class="number">1</span>].y:=<span class="number">1000000</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n+<span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    l[i].a:=p[i-<span class="number">1</span>];</span><br><span class="line">    l[i].b:=p[i];</span><br><span class="line">    l[i].k:=arctan((p[i-<span class="number">1</span>].y-p[i].y)/(p[i-<span class="number">1</span>].x-p[i].x+eps));</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  unique;</span><br><span class="line">  solve;</span><br><span class="line">  writeln(ans:<span class="number">0</span>:<span class="number">3</span>);</span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;a href=&quot;http://www.lydsy.com/JudgeOnline/problem.php?id=1038&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;传送门&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;先贴一发&lt;a hre
      
    
    </summary>
    
      <category term="BZOJ" scheme="http://platypuspro.github.io/categories/BZOJ/"/>
    
    
      <category term="Half-Plane Intersection" scheme="http://platypuspro.github.io/tags/Half-Plane-Intersection/"/>
    
  </entry>
  
  <entry>
    <title>BZOJ 2599</title>
    <link href="http://platypuspro.github.io/posts/bzoj-2599/"/>
    <id>http://platypuspro.github.io/posts/bzoj-2599/</id>
    <published>2015-06-18T12:35:40.000Z</published>
    <updated>2015-06-18T12:51:54.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=2599" target="_blank" rel="noopener">不稳定的传送门</a></p><p>对于当前的重心，遍历当前重心的子树时，假设遍历到的点距重心距离为$d$，那么需要找在遍历过的<strong>当前重心</strong>的其他子树中是否走过一条长度为$k-d$的边，若存在一条长度为$k-d$的边，说明能拼成一条长度为$k$的路径，更新答案，为了更新答案还要记录一下到达每个长度所需的最小边数</p><p>具体实现需要开一个数组存一个类似时间标记的东西，比如遍历到距离为$d$的点时，就把数组中下标为$d$的值赋为当前$root$，表示在$root$的子树中遍历到过一条长度为$d$的边，搜其他子树再遇到时直接判断下标$k-d$的地方存的$root$是否等于当前$root$就行了，若等于就可以合法地拼在一起</p><p>若$root$的子树中出现过多条长度相同的路径，取经过边数最少的那个</p><p>每次搜完一棵子树后将这棵子树合并进当前状态中</p><p><i class="fa fa-code fa-2x"></i><br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">program</span> bzoj_2599;</span><br><span class="line"><span class="keyword">var</span> l:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">400000</span>]<span class="keyword">of</span> <span class="keyword">record</span> ed,pre,len:longint; <span class="keyword">end</span>;</span><br><span class="line">    lst,size,d,e:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">200000</span>]<span class="keyword">of</span> longint;</span><br><span class="line">    s:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1000000</span>]<span class="keyword">of</span> <span class="keyword">record</span> rt,e:longint; <span class="keyword">end</span>;</span><br><span class="line">    n,len,i,tot,a,b,c,min,root,ans:longint;</span><br><span class="line">    v:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">200000</span>]<span class="keyword">of</span> boolean;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">link</span><span class="params">(a,b,len:longint)</span>;</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  inc(tot);</span><br><span class="line">  l[tot].pre:=lst[a];</span><br><span class="line">  lst[a]:=tot;</span><br><span class="line">  l[tot].ed:=b;</span><br><span class="line">  l[tot].len:=len;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">getroot</span><span class="params">(t,fa:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> k,max:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  size[t]:=<span class="number">1</span>;</span><br><span class="line">  k:=lst[t];</span><br><span class="line">  max:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> k&lt;&gt;<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (l[k].ed&lt;&gt;fa)<span class="keyword">and</span>(<span class="keyword">not</span> v[l[k].ed]) <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      getroot(l[k].ed,t);</span><br><span class="line">      <span class="keyword">if</span> size[l[k].ed]&gt;max <span class="keyword">then</span> max:=size[l[k].ed];</span><br><span class="line">      inc(size[t],size[l[k].ed]);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    k:=l[k].pre;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">if</span> tot-size[t]&gt;max <span class="keyword">then</span> max:=tot-size[t];</span><br><span class="line">  <span class="keyword">if</span> max&lt;min <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    min:=max;</span><br><span class="line">    root:=t;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">find</span><span class="params">(t,fa:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> k:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">if</span> d[t]&gt;len <span class="keyword">then</span> <span class="keyword">exit</span>;</span><br><span class="line">  <span class="keyword">if</span> (s[len-d[t]].rt=root)<span class="keyword">and</span>(e[t]+s[len-d[t]].e&lt;ans) <span class="keyword">then</span> ans:=e[t]+s[len-d[t]].e;</span><br><span class="line">  k:=lst[t];</span><br><span class="line">  <span class="keyword">while</span> k&lt;&gt;<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (l[k].ed&lt;&gt;fa)<span class="keyword">and</span>(<span class="keyword">not</span> v[l[k].ed]) <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      d[l[k].ed]:=d[t]+l[k].len;</span><br><span class="line">      e[l[k].ed]:=e[t]+<span class="number">1</span>;</span><br><span class="line">      find(l[k].ed,t);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    k:=l[k].pre;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">merge</span><span class="params">(t,fa:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> k:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">if</span> d[t]&gt;len <span class="keyword">then</span> <span class="keyword">exit</span>;</span><br><span class="line">  <span class="keyword">if</span> s[d[t]].rt&lt;&gt;root <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    s[d[t]].rt:=root;</span><br><span class="line">    s[d[t]].e:=e[t];</span><br><span class="line">  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">if</span> e[t]&lt;s[d[t]].e <span class="keyword">then</span> s[d[t]].e:=e[t];</span><br><span class="line">  k:=lst[t];</span><br><span class="line">  <span class="keyword">while</span> k&lt;&gt;<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (l[k].ed&lt;&gt;fa)<span class="keyword">and</span>(<span class="keyword">not</span> v[l[k].ed]) <span class="keyword">then</span> merge(l[k].ed,t);</span><br><span class="line">    k:=l[k].pre;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">solve</span><span class="params">(t:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> p,k:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  p:=tot;</span><br><span class="line">  v[t]:=true;</span><br><span class="line">  s[<span class="number">0</span>].rt:=t;</span><br><span class="line">  s[<span class="number">0</span>].e:=<span class="number">0</span>;</span><br><span class="line">  k:=lst[t];</span><br><span class="line">  <span class="keyword">while</span> k&lt;&gt;<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> v[l[k].ed] <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      d[l[k].ed]:=l[k].len;</span><br><span class="line">      e[l[k].ed]:=<span class="number">1</span>;</span><br><span class="line">      find(l[k].ed,t);</span><br><span class="line">      merge(l[k].ed,t);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    k:=l[k].pre;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  k:=lst[t];</span><br><span class="line">  <span class="keyword">while</span> k&lt;&gt;<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> v[l[k].ed] <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      <span class="keyword">if</span> size[l[k].ed]&lt;size[t] <span class="keyword">then</span> tot:=size[l[k].ed] <span class="keyword">else</span> tot:=p-size[t];</span><br><span class="line">      min:=maxlongint;</span><br><span class="line">      getroot(l[k].ed,t);</span><br><span class="line">      solve(root);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    k:=l[k].pre;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  readln(n,len);</span><br><span class="line">  tot:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n-<span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    readln(a,b,c);</span><br><span class="line">    link(a+<span class="number">1</span>,b+<span class="number">1</span>,c);</span><br><span class="line">    link(b+<span class="number">1</span>,a+<span class="number">1</span>,c);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  tot:=n;</span><br><span class="line">  min:=maxlongint;</span><br><span class="line">  getroot(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">  ans:=maxlongint;</span><br><span class="line">  solve(root);</span><br><span class="line">  <span class="keyword">if</span> ans&lt;&gt;maxlongint <span class="keyword">then</span> writeln(ans) <span class="keyword">else</span> writeln(<span class="string">'-1'</span>);</span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;a href=&quot;http://www.lydsy.com/JudgeOnline/problem.php?id=2599&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;不稳定的传送门&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;对于当前的重
      
    
    </summary>
    
      <category term="BZOJ" scheme="http://platypuspro.github.io/categories/BZOJ/"/>
    
    
      <category term="Divide and Conquer" scheme="http://platypuspro.github.io/tags/Divide-and-Conquer/"/>
    
  </entry>
  
  <entry>
    <title>POJ 1741</title>
    <link href="http://platypuspro.github.io/posts/poj-1741/"/>
    <id>http://platypuspro.github.io/posts/poj-1741/</id>
    <published>2015-06-16T23:55:40.000Z</published>
    <updated>2015-06-17T01:59:30.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p><a href="http://poj.org/problem?id=1741" target="_blank" rel="noopener">POJ传送门</a><br><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=1468" target="_blank" rel="noopener">BZOJ不稳定的传送门</a></p><p>对于每次找到的根，算出来所有到根长度不超过$K$的路径，看两两组合能构成多少条经过根的长度不超过$K$的路径，更新答案</p><p>但这样的路径可能会重复经过同一个点，所以再减掉子树中重复算的</p><p><i class="fa fa-code fa-2x"></i><br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">program</span> poj_1741;</span><br><span class="line"><span class="keyword">var</span> l:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">20000</span>]<span class="keyword">of</span> <span class="keyword">record</span> ed,pre,len:longint; <span class="keyword">end</span>;</span><br><span class="line">    lst,size,d,seq:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">10000</span>]<span class="keyword">of</span> longint;</span><br><span class="line">    n,lim,i,a,b,tot,len,maxsize,root,ans:longint;</span><br><span class="line">    v:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">10000</span>]<span class="keyword">of</span> boolean;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">link</span><span class="params">(a,b,len:longint)</span>;</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  inc(tot);</span><br><span class="line">  l[tot].pre:=lst[a];</span><br><span class="line">  lst[a]:=tot;</span><br><span class="line">  l[tot].ed:=b;</span><br><span class="line">  l[tot].len:=len;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">dfs</span><span class="params">(t,fa:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> k,max:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  size[t]:=<span class="number">1</span>;</span><br><span class="line">  max:=<span class="number">0</span>;</span><br><span class="line">  k:=lst[t];</span><br><span class="line">  <span class="keyword">while</span> k&lt;&gt;<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (l[k].ed&lt;&gt;fa)<span class="keyword">and</span>(<span class="keyword">not</span> v[l[k].ed]) <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      dfs(l[k].ed,t);</span><br><span class="line">      <span class="keyword">if</span> size[l[k].ed]&gt;max <span class="keyword">then</span> max:=size[l[k].ed];</span><br><span class="line">      inc(size[t],size[l[k].ed]);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    k:=l[k].pre;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">if</span> tot-size[t]&gt;max <span class="keyword">then</span> max:=tot-size[t];</span><br><span class="line">  <span class="keyword">if</span> max&lt;maxsize <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    maxsize:=max;</span><br><span class="line">    root:=t;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">qsort</span><span class="params">(l,r:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> i,j,mid,p:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  i:=l;</span><br><span class="line">  j:=r;</span><br><span class="line">  mid:=d[seq[(l+r)&gt;&gt;<span class="number">1</span>]];</span><br><span class="line">  <span class="keyword">repeat</span></span><br><span class="line">    <span class="keyword">while</span> d[seq[i]]&lt;mid <span class="keyword">do</span> inc(i);</span><br><span class="line">    <span class="keyword">while</span> d[seq[j]]&gt;mid <span class="keyword">do</span> dec(j);</span><br><span class="line">    <span class="keyword">if</span> i&lt;=j <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      p:=seq[i];</span><br><span class="line">      seq[i]:=seq[j];</span><br><span class="line">      seq[j]:=p;</span><br><span class="line">      inc(i);</span><br><span class="line">      dec(j);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">until</span> i&gt;j;</span><br><span class="line">  <span class="keyword">if</span> i&lt;r <span class="keyword">then</span> qsort(i,r);</span><br><span class="line">  <span class="keyword">if</span> l&lt;j <span class="keyword">then</span> qsort(l,j);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">calc_dis</span><span class="params">(t,fa:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> k:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  inc(len);</span><br><span class="line">  seq[len]:=t;</span><br><span class="line">  k:=lst[t];</span><br><span class="line">  <span class="keyword">while</span> k&lt;&gt;<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">not</span> v[l[k].ed])<span class="keyword">and</span>(l[k].ed&lt;&gt;fa)<span class="keyword">and</span>(d[t]+l[k].len&lt;=lim) <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      d[l[k].ed]:=d[t]+l[k].len;</span><br><span class="line">      calc_dis(l[k].ed,t);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    k:=l[k].pre;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calc</span><span class="params">(t,dis:longint)</span>:</span>longint;</span><br><span class="line"><span class="keyword">var</span> l,r:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  d[t]:=dis;</span><br><span class="line">  len:=<span class="number">0</span>;</span><br><span class="line">  calc_dis(t,<span class="number">0</span>);</span><br><span class="line">  qsort(<span class="number">1</span>,len);</span><br><span class="line">  calc:=<span class="number">0</span>;</span><br><span class="line">  r:=len;</span><br><span class="line">  <span class="keyword">for</span> l:=<span class="number">1</span> <span class="keyword">to</span> len-<span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> d[seq[l]]+d[seq[l+<span class="number">1</span>]]&gt;lim <span class="keyword">then</span> <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">while</span> (r&gt;l)<span class="keyword">and</span>(d[seq[l]]+d[seq[r]]&gt;lim) <span class="keyword">do</span> dec(r);</span><br><span class="line">    <span class="keyword">while</span> (r&lt;len)<span class="keyword">and</span>(d[seq[l]]+d[seq[r+<span class="number">1</span>]]&lt;=lim) <span class="keyword">do</span> inc(r);</span><br><span class="line">    inc(calc,r-l);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">solve</span><span class="params">(t:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> k,p:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  p:=tot;</span><br><span class="line">  v[t]:=true;</span><br><span class="line">  inc(ans,calc(t,<span class="number">0</span>));</span><br><span class="line">  k:=lst[t];</span><br><span class="line">  <span class="keyword">while</span> k&lt;&gt;<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> v[l[k].ed] <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      dec(ans,calc(l[k].ed,l[k].len));</span><br><span class="line">      <span class="keyword">if</span> size[l[k].ed]&lt;size[t] <span class="keyword">then</span> tot:=size[l[k].ed] <span class="keyword">else</span> tot:=p-size[t];</span><br><span class="line">      maxsize:=maxlongint;</span><br><span class="line">      dfs(l[k].ed,t);</span><br><span class="line">      solve(root);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    k:=l[k].pre;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">repeat</span></span><br><span class="line">    readln(n,lim);</span><br><span class="line">    <span class="keyword">if</span> (n=<span class="number">0</span>)<span class="keyword">and</span>(lim=<span class="number">0</span>) <span class="keyword">then</span> <span class="keyword">exit</span>;</span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> lst[i]:=<span class="number">0</span>;</span><br><span class="line">    fillchar(v,sizeof(v),false);</span><br><span class="line">    tot:=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n-<span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      readln(a,b,len);</span><br><span class="line">      link(a,b,len);</span><br><span class="line">      link(b,a,len);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    tot:=n;</span><br><span class="line">    maxsize:=maxlongint;</span><br><span class="line">    ans:=<span class="number">0</span>;</span><br><span class="line">    dfs(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">    solve(root);</span><br><span class="line">    writeln(ans);</span><br><span class="line">  <span class="keyword">until</span> false;</span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;a href=&quot;http://poj.org/problem?id=1741&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;POJ传送门&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;http://www.lydsy.com/Jud
      
    
    </summary>
    
      <category term="POJ" scheme="http://platypuspro.github.io/categories/POJ/"/>
    
    
      <category term="Divide and Conquer" scheme="http://platypuspro.github.io/tags/Divide-and-Conquer/"/>
    
  </entry>
  
  <entry>
    <title>BZOJ 2821</title>
    <link href="http://platypuspro.github.io/posts/bzoj-2821/"/>
    <id>http://platypuspro.github.io/posts/bzoj-2821/</id>
    <published>2015-06-16T13:14:23.000Z</published>
    <updated>2015-06-16T23:52:38.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=2821" target="_blank" rel="noopener">传送门</a></p><p>这道题用到了类似区间众数的方法，所以先贴个资料 <a href="http://www.docin.com/p-679227660.html" target="_blank" rel="noopener">区间众数解题报告 –WJMZBMR</a></p><p>首先，用暴力的循环和一个统计数组可以算出某区间$[l,r]$中多少个数出现偶数次吧…</p><p>然后将数列分块，暴力处理出$f_{i,j}$表示从第$i$块到第$j$块多少个数出现偶数次</p><p>对于询问$[l,r]$，只需要统计区间两边不满一块的对已经处理出来的整块答案的影响</p><ul><li>若两边偶数次 整块奇数次或没出现 答案++</li><li>若两边奇数次 整块偶数次 答案–</li></ul><p>现在的问题是如何统计区间中一个数的出现次数</p><p>这个也很好解决，将所有数按数值为第一关键字，位置为第二关键字排序，然后直接在每个数的区间里二分查找$l$之后的位置和$r$之前的位置，两个位置相减就是$[l,r]$中的出现次数</p><p><i class="fa fa-code fa-2x"></i><br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">program</span> bzoj_2821;</span><br><span class="line"><span class="keyword">type</span> rec=<span class="keyword">record</span> p,x:longint; <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">var</span> f:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">1500</span>,<span class="number">1</span>..<span class="number">1500</span>]<span class="keyword">of</span> longint;</span><br><span class="line">    a,ll,rr,cnt,st,ed:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">100000</span>]<span class="keyword">of</span> longint;</span><br><span class="line">    b:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">100000</span>]<span class="keyword">of</span> rec;</span><br><span class="line">    mk:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">100000</span>]<span class="keyword">of</span> boolean;</span><br><span class="line">    n,m,c,i,ans,size,block,l,r,log:longint;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">swap</span><span class="params">(<span class="keyword">var</span> a,b:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> p:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  p:=a;</span><br><span class="line">  a:=b;</span><br><span class="line">  b:=p;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">find</span><span class="params">(p,x:longint;flag:boolean)</span>:</span>longint;</span><br><span class="line"><span class="keyword">var</span> l,r,mid:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">if</span> flag <span class="keyword">then</span> find:=<span class="number">0</span> <span class="keyword">else</span> find:=n+<span class="number">1</span>;</span><br><span class="line">  l:=st[x];</span><br><span class="line">  r:=ed[x];</span><br><span class="line">  <span class="keyword">while</span> l&lt;=r <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    mid:=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span> p=b[mid].p <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      find:=mid;</span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">not</span> flag <span class="keyword">then</span> r:=mid-<span class="number">1</span> <span class="keyword">else</span> l:=mid+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">if</span> p&lt;b[mid].p <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      <span class="keyword">if</span> <span class="keyword">not</span> flag <span class="keyword">then</span> find:=mid;</span><br><span class="line">      r:=mid-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">if</span> p&gt;b[mid].p <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      <span class="keyword">if</span> flag <span class="keyword">then</span> find:=mid;</span><br><span class="line">      l:=mid+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">count</span><span class="params">(l,r,x:longint)</span>:</span>longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  count:=find(r,x,true)-find(l,x,false)+<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> count&lt;<span class="number">0</span> <span class="keyword">then</span> <span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">qsort</span><span class="params">(l,r:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> i,j:longint;</span><br><span class="line">    mid:rec;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  i:=l;</span><br><span class="line">  j:=r;</span><br><span class="line">  mid:=b[(l+r)&gt;&gt;<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">repeat</span></span><br><span class="line">    <span class="keyword">while</span> (b[i].x&lt;mid.x)<span class="keyword">or</span>((b[i].x=mid.x)<span class="keyword">and</span>(b[i].p&lt;mid.p)) <span class="keyword">do</span> inc(i);</span><br><span class="line">    <span class="keyword">while</span> (b[j].x&gt;mid.x)<span class="keyword">or</span>((b[j].x=mid.x)<span class="keyword">and</span>(b[j].p&gt;mid.p)) <span class="keyword">do</span> dec(j);</span><br><span class="line">    <span class="keyword">if</span> i&lt;=j <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      swap(b[i].p,b[j].p);</span><br><span class="line">      swap(b[i].x,b[j].x);</span><br><span class="line">      inc(i);</span><br><span class="line">      dec(j);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">until</span> i&gt;j;</span><br><span class="line">  <span class="keyword">if</span> i&lt;r <span class="keyword">then</span> qsort(i,r);</span><br><span class="line">  <span class="keyword">if</span> l&lt;j <span class="keyword">then</span> qsort(l,j);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">init</span>;</span></span><br><span class="line"><span class="keyword">var</span> i,j,k,tot:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> block <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">for</span> j:=ll[i] <span class="keyword">to</span> n <span class="keyword">do</span> cnt[a[j]]:=<span class="number">0</span>;</span><br><span class="line">    tot:=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> j:=i <span class="keyword">to</span> block <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      <span class="keyword">for</span> k:=ll[j] <span class="keyword">to</span> rr[j] <span class="keyword">do</span></span><br><span class="line">      <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (cnt[a[k]] <span class="keyword">and</span> <span class="number">1</span>=<span class="number">0</span>)<span class="keyword">and</span>(cnt[a[k]]&lt;&gt;<span class="number">0</span>) <span class="keyword">then</span> dec(tot);</span><br><span class="line">        <span class="keyword">if</span> cnt[a[k]] <span class="keyword">and</span> <span class="number">1</span>=<span class="number">1</span> <span class="keyword">then</span> inc(tot);</span><br><span class="line">        inc(cnt[a[k]]);</span><br><span class="line">      <span class="keyword">end</span>;</span><br><span class="line">      f[i,j]:=tot;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    b[i].x:=a[i];</span><br><span class="line">    b[i].p:=i;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  qsort(<span class="number">1</span>,n);</span><br><span class="line">  i:=<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> i&lt;=n <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    st[b[i].x]:=i;</span><br><span class="line">    <span class="keyword">while</span> (i&lt;n)<span class="keyword">and</span>(b[i+<span class="number">1</span>].x=b[i].x) <span class="keyword">do</span> inc(i);</span><br><span class="line">    ed[b[i].x]:=i;</span><br><span class="line">    inc(i);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">solve</span><span class="params">(x,y:longint)</span>:</span>longint;</span><br><span class="line"><span class="keyword">var</span> i,l,r,c1,c2,ans:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">if</span> x&gt;y <span class="keyword">then</span> swap(x,y);</span><br><span class="line">  ans:=<span class="number">0</span>;</span><br><span class="line">  l:=(x-<span class="number">1</span>)<span class="keyword">div</span> size+<span class="number">1</span>;</span><br><span class="line">  r:=(y-<span class="number">1</span>)<span class="keyword">div</span> size+<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> l+<span class="number">1</span>&gt;=r <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">for</span> i:=x <span class="keyword">to</span> y <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">not</span> mk[a[i]])<span class="keyword">and</span>(count(x,y,a[i]) <span class="keyword">and</span> <span class="number">1</span>=<span class="number">0</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      mk[a[i]]:=true;</span><br><span class="line">      inc(ans);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">for</span> i:=x <span class="keyword">to</span> y <span class="keyword">do</span> mk[a[i]]:=false;</span><br><span class="line">  <span class="keyword">end</span> <span class="keyword">else</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    inc(l);</span><br><span class="line">    dec(r);</span><br><span class="line">    ans:=f[l,r];</span><br><span class="line">    <span class="keyword">for</span> i:=x <span class="keyword">to</span> ll[l]-<span class="number">1</span> <span class="keyword">do</span> <span class="keyword">if</span> <span class="keyword">not</span> mk[a[i]] <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      c1:=count(x,y,a[i]);</span><br><span class="line">      c2:=count(ll[l],rr[r],a[i]);</span><br><span class="line">      <span class="keyword">if</span> (c1 <span class="keyword">and</span> <span class="number">1</span>=<span class="number">0</span>)<span class="keyword">and</span>(c2 <span class="keyword">and</span> <span class="number">1</span>=<span class="number">1</span>) <span class="keyword">then</span> inc(ans);</span><br><span class="line">      <span class="keyword">if</span> (c1 <span class="keyword">and</span> <span class="number">1</span>=<span class="number">0</span>)<span class="keyword">and</span>(c1&lt;&gt;<span class="number">0</span>)<span class="keyword">and</span>(c2=<span class="number">0</span>) <span class="keyword">then</span> inc(ans);</span><br><span class="line">      <span class="keyword">if</span> (c1 <span class="keyword">and</span> <span class="number">1</span>=<span class="number">1</span>)<span class="keyword">and</span>(c2 <span class="keyword">and</span> <span class="number">1</span>=<span class="number">0</span>)<span class="keyword">and</span>(c2&lt;&gt;<span class="number">0</span>) <span class="keyword">then</span> dec(ans);</span><br><span class="line">      mk[a[i]]:=true;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">for</span> i:=rr[r]+<span class="number">1</span> <span class="keyword">to</span> y <span class="keyword">do</span> <span class="keyword">if</span> <span class="keyword">not</span> mk[a[i]] <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      c1:=count(x,y,a[i]);</span><br><span class="line">      c2:=count(ll[l],rr[r],a[i]);</span><br><span class="line">      <span class="keyword">if</span> (c1 <span class="keyword">and</span> <span class="number">1</span>=<span class="number">0</span>)<span class="keyword">and</span>(c2 <span class="keyword">and</span> <span class="number">1</span>=<span class="number">1</span>) <span class="keyword">then</span> inc(ans);</span><br><span class="line">      <span class="keyword">if</span> (c1 <span class="keyword">and</span> <span class="number">1</span>=<span class="number">0</span>)<span class="keyword">and</span>(c1&lt;&gt;<span class="number">0</span>)<span class="keyword">and</span>(c2=<span class="number">0</span>) <span class="keyword">then</span> inc(ans);</span><br><span class="line">      <span class="keyword">if</span> (c1 <span class="keyword">and</span> <span class="number">1</span>=<span class="number">1</span>)<span class="keyword">and</span>(c2 <span class="keyword">and</span> <span class="number">1</span>=<span class="number">0</span>)<span class="keyword">and</span>(c2&lt;&gt;<span class="number">0</span>) <span class="keyword">then</span> dec(ans);</span><br><span class="line">      mk[a[i]]:=true;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">for</span> i:=x <span class="keyword">to</span> ll[l]-<span class="number">1</span> <span class="keyword">do</span> mk[a[i]]:=false;</span><br><span class="line">    <span class="keyword">for</span> i:=rr[r]+<span class="number">1</span> <span class="keyword">to</span> y <span class="keyword">do</span> mk[a[i]]:=false;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">exit</span>(ans);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  readln(n,c,m);</span><br><span class="line">  log:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> <span class="number">1</span>&lt;&lt;log&lt;=n <span class="keyword">do</span> inc(log);</span><br><span class="line">  size:=trunc(sqrt(n/log));</span><br><span class="line">  block:=n <span class="keyword">div</span> size+ord(n <span class="keyword">mod</span> size&lt;&gt;<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> block <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    ll[i]:=(i-<span class="number">1</span>)*size+<span class="number">1</span>;</span><br><span class="line">    rr[i]:=i*size;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  rr[block]:=n;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">read</span>(a[i]);</span><br><span class="line">  init;</span><br><span class="line">  ans:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    readln(l,r);</span><br><span class="line">    ans:=solve((l+ans)<span class="keyword">mod</span> n+<span class="number">1</span>,(r+ans)<span class="keyword">mod</span> n+<span class="number">1</span>);</span><br><span class="line">    writeln(ans);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;a href=&quot;http://www.lydsy.com/JudgeOnline/problem.php?id=2821&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;传送门&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;这道题用到了类似区间
      
    
    </summary>
    
      <category term="BZOJ" scheme="http://platypuspro.github.io/categories/BZOJ/"/>
    
    
      <category term="Partitioning" scheme="http://platypuspro.github.io/tags/Partitioning/"/>
    
  </entry>
  
  <entry>
    <title>BZOJ 2141</title>
    <link href="http://platypuspro.github.io/posts/bzoj-2141/"/>
    <id>http://platypuspro.github.io/posts/bzoj-2141/</id>
    <published>2015-06-14T10:05:02.000Z</published>
    <updated>2015-06-14T10:34:28.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=2141" target="_blank" rel="noopener">传送门</a></p><p>正常的解法是树套树<del>然而我不会</del> 所以写了个分块</p><p>假设现在要交换$l$与$r$，使答案发生变化的只会出现在$l$之后$r$之前也就是$l,r$之间，只需要查询区间中的变化就行了</p><p>对于$(l,r)$中的一个$i$，若$h_i&gt;h_l$或$h_i&lt;h_r$，交换后会分别产生一对新的逆序对，逆序对减少时同理</p><p>这样就得到了暴力的方法，每次循环这个区间，判断$4$种情况即可</p><p>把序列分块，每块建个树状数组，对于每次修改，区间两边不满一块的暴力，整块的直接在树状数组里查</p><p>这题有元素重复的情况，离散化的时候需要注意一下</p><p><del>有空了把树套树的坑填了</del></p><p><i class="fa fa-code fa-2x"></i><br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">program</span> bzoj_2141;</span><br><span class="line"><span class="keyword">type</span> rec=<span class="keyword">record</span> x,id:longint; <span class="keyword">end</span>;</span><br><span class="line">     arr=<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">20000</span>]<span class="keyword">of</span> longint;</span><br><span class="line"><span class="keyword">var</span> bit:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">150</span>]<span class="keyword">of</span> arr;</span><br><span class="line">    ll,rr:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">150</span>]<span class="keyword">of</span> longint;</span><br><span class="line">    t:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">20000</span>]<span class="keyword">of</span> rec;</span><br><span class="line">    a:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">20000</span>]<span class="keyword">of</span> longint;</span><br><span class="line">    n,m,i,x,y,size,ans,tot,block:longint;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">swap</span><span class="params">(<span class="keyword">var</span> a,b:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> p:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  p:=a;</span><br><span class="line">  a:=b;</span><br><span class="line">  b:=p;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">c</span><span class="params">(x:longint)</span>:</span>longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">exit</span>(x <span class="keyword">and</span> -x);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">modify</span><span class="params">(<span class="keyword">var</span> b:arr;p,d:longint)</span>;</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">while</span> p&lt;=tot <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    inc(b[p],d);</span><br><span class="line">    inc(p,c(p));</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">query</span><span class="params">(<span class="keyword">var</span> b:arr;p:longint)</span>:</span>longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  query:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> p&gt;<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    inc(query,b[p]);</span><br><span class="line">    dec(p,c(p));</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">qsort</span><span class="params">(l,r:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> i,j:longint;</span><br><span class="line">    mid,p:rec;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  i:=l;</span><br><span class="line">  j:=r;</span><br><span class="line">  mid:=t[(l+r)&gt;&gt;<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">repeat</span></span><br><span class="line">    <span class="keyword">while</span> t[i].x&lt;mid.x <span class="keyword">do</span> inc(i);</span><br><span class="line">    <span class="keyword">while</span> t[j].x&gt;mid.x <span class="keyword">do</span> dec(j);</span><br><span class="line">    <span class="keyword">if</span> i&lt;=j <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      p:=t[i];</span><br><span class="line">      t[i]:=t[j];</span><br><span class="line">      t[j]:=p;</span><br><span class="line">      inc(i);</span><br><span class="line">      dec(j);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">until</span> i&gt;j;</span><br><span class="line">  <span class="keyword">if</span> i&lt;r <span class="keyword">then</span> qsort(i,r);</span><br><span class="line">  <span class="keyword">if</span> l&lt;j <span class="keyword">then</span> qsort(l,j);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">update</span><span class="params">(t,l,r:longint)</span>;</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  dec(ans,ord(t&lt;l)+ord(t&gt;r));</span><br><span class="line">  inc(ans,ord(t&gt;l)+ord(t&lt;r));</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">solve</span>;</span></span><br><span class="line"><span class="keyword">var</span> l,r,i:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">if</span> x&gt;y <span class="keyword">then</span> swap(x,y);</span><br><span class="line">  l:=(x-<span class="number">1</span>) <span class="keyword">div</span> size+<span class="number">1</span>;</span><br><span class="line">  r:=(y-<span class="number">1</span>) <span class="keyword">div</span> size+<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> l&lt;&gt;r <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">for</span> i:=x+<span class="number">1</span> <span class="keyword">to</span> rr[l] <span class="keyword">do</span> update(a[i],a[x],a[y]);</span><br><span class="line">    <span class="keyword">for</span> i:=ll[r] <span class="keyword">to</span> y-<span class="number">1</span> <span class="keyword">do</span> update(a[i],a[x],a[y]);</span><br><span class="line">    <span class="keyword">for</span> i:=l+<span class="number">1</span> <span class="keyword">to</span> r-<span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      dec(ans,query(bit[i],a[x]-<span class="number">1</span>));</span><br><span class="line">      inc(ans,query(bit[i],a[y]-<span class="number">1</span>));</span><br><span class="line">      inc(ans,query(bit[i],tot)-query(bit[i],a[x]));</span><br><span class="line">      dec(ans,query(bit[i],tot)-query(bit[i],a[y]));</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">end</span> <span class="keyword">else</span> <span class="keyword">for</span> i:=x+<span class="number">1</span> <span class="keyword">to</span> y-<span class="number">1</span> <span class="keyword">do</span> update(a[i],a[x],a[y]);</span><br><span class="line">  <span class="keyword">if</span> a[x]&lt;a[y] <span class="keyword">then</span> inc(ans) <span class="keyword">else</span> <span class="keyword">if</span> a[x]&gt;a[y] <span class="keyword">then</span> dec(ans);</span><br><span class="line">  writeln(ans);</span><br><span class="line">  modify(bit[l],a[x],-<span class="number">1</span>);</span><br><span class="line">  modify(bit[l],a[y],<span class="number">1</span>);</span><br><span class="line">  modify(bit[r],a[y],-<span class="number">1</span>);</span><br><span class="line">  modify(bit[r],a[x],<span class="number">1</span>);</span><br><span class="line">  swap(a[x],a[y]);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  readln(n);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">read</span>(t[i].x);</span><br><span class="line">    t[i].id:=i;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  qsort(<span class="number">1</span>,n);</span><br><span class="line">  tot:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (i=<span class="number">1</span>)<span class="keyword">or</span>(t[i].x&lt;&gt;t[i-<span class="number">1</span>].x) <span class="keyword">then</span> inc(tot);</span><br><span class="line">    a[t[i].id]:=tot;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  ans:=<span class="number">0</span>;</span><br><span class="line">  size:=trunc(sqrt(n));</span><br><span class="line">  block:=n <span class="keyword">div</span> size;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    inc(ans,query(bit[<span class="number">0</span>],tot)-query(bit[<span class="number">0</span>],a[i]));</span><br><span class="line">    modify(bit[<span class="number">0</span>],a[i],<span class="number">1</span>);</span><br><span class="line">    modify(bit[(i-<span class="number">1</span>)<span class="keyword">div</span> size+<span class="number">1</span>],a[i],<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  writeln(ans);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> block <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    ll[i]:=(i-<span class="number">1</span>)*size+<span class="number">1</span>;</span><br><span class="line">    rr[i]:=i*size;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">if</span> n <span class="keyword">mod</span> size&lt;&gt;<span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    inc(block);</span><br><span class="line">    ll[block]:=rr[block-<span class="number">1</span>]+<span class="number">1</span>;</span><br><span class="line">    rr[block]:=n;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  readln(m);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    readln(x,y);</span><br><span class="line">    solve;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;a href=&quot;http://www.lydsy.com/JudgeOnline/problem.php?id=2141&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;传送门&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;正常的解法是树套树&lt;
      
    
    </summary>
    
      <category term="BZOJ" scheme="http://platypuspro.github.io/categories/BZOJ/"/>
    
    
      <category term="Partitioning" scheme="http://platypuspro.github.io/tags/Partitioning/"/>
    
      <category term="Binary Indexed Tree" scheme="http://platypuspro.github.io/tags/Binary-Indexed-Tree/"/>
    
  </entry>
  
  <entry>
    <title>BZOJ 2819</title>
    <link href="http://platypuspro.github.io/posts/bzoj-2819/"/>
    <id>http://platypuspro.github.io/posts/bzoj-2819/</id>
    <published>2015-06-13T11:44:39.000Z</published>
    <updated>2015-06-13T12:02:38.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=2819" target="_blank" rel="noopener">传送门</a></p><p>又是一道感人肺腑的题TAT…凭什么某++可以很舒服地写倍增，PASCAL却还要拿${\rm Tarjan}$卡时</p><p>首先，若许多堆石子的异或值为$0$，那么就没有先手必胜策略，因为后手的人总能把自己行动后的${\rm SG}$值变为$0$</p><p>那么题就成了查询路径上所有点权的异或值，即$W_{u\rightarrow root}\oplus W_{v\rightarrow root}\oplus W_{lca(u,v)}$</p><p>直接DFS序+树状数组即可</p><p>若修改一个点的点权，只会对其子树中的点有影响，只要修改进DFS序和出DFS序+1的位置就行了</p><p><del>没有读入优化真不爽 尼玛最大一组数据20M让PASCAL怎么读</del></p><p><i class="fa fa-code fa-2x"></i><br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">program</span> bzoj_2819;</span><br><span class="line"><span class="keyword">var</span> n,i,a,b,tot,q,t:longint;</span><br><span class="line">    l:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">1000000</span>]<span class="keyword">of</span> <span class="keyword">record</span> ed,pre:longint; <span class="keyword">end</span>;</span><br><span class="line">    ll:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">1000000</span>]<span class="keyword">of</span> <span class="keyword">record</span> ed,pre,id:longint; <span class="keyword">end</span>;</span><br><span class="line">    lst,dep,st,pl,pr,lnk,x,y,lca:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">500000</span>]<span class="keyword">of</span> longint;</span><br><span class="line">    fa:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">500000</span>]<span class="keyword">of</span> longint;</span><br><span class="line">    bit:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">1000000</span>]<span class="keyword">of</span> longint;</span><br><span class="line">    ch:char;</span><br><span class="line">    ask,v:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">500000</span>]<span class="keyword">of</span> boolean;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">link</span><span class="params">(a,b:longint)</span>;</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  inc(tot);</span><br><span class="line">  l[tot].pre:=lst[a];</span><br><span class="line">  lst[a]:=tot;</span><br><span class="line">  l[tot].ed:=b;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">link_</span><span class="params">(a,b:longint)</span>;</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  inc(tot);</span><br><span class="line">  ll[tot].pre:=lnk[a];</span><br><span class="line">  lnk[a]:=tot;</span><br><span class="line">  ll[tot].ed:=b;</span><br><span class="line">  ll[tot].id:=i;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">findfa</span><span class="params">(x:longint)</span>:</span>longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">if</span> fa[x]&lt;&gt;x <span class="keyword">then</span> fa[x]:=findfa(fa[x]);</span><br><span class="line">  <span class="keyword">exit</span>(fa[x]);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">c</span><span class="params">(x:longint)</span>:</span>longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">exit</span>(x <span class="keyword">and</span> -x);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">query</span><span class="params">(p:longint)</span>:</span>longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  query:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> p&gt;<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    query:=query xor bit[p];</span><br><span class="line">    dec(p,c(p));</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">modify</span><span class="params">(p,d:longint)</span>;</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">while</span> p&lt;=n&lt;&lt;<span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    bit[p]:=bit[p] xor d;</span><br><span class="line">    inc(p,c(p));</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">dfs</span><span class="params">(t,f:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> k:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  v[t]:=true;</span><br><span class="line">  fa[t]:=t;</span><br><span class="line">  inc(tot);</span><br><span class="line">  pl[t]:=tot;</span><br><span class="line">  modify(tot,st[t]);</span><br><span class="line">  k:=lnk[t];</span><br><span class="line">  <span class="keyword">while</span> k&lt;&gt;<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> v[ll[k].ed] <span class="keyword">then</span> lca[ll[k].id]:=findfa(ll[k].ed);</span><br><span class="line">    k:=ll[k].pre;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  k:=lst[t];</span><br><span class="line">  <span class="keyword">while</span> k&lt;&gt;<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> l[k].ed&lt;&gt;f <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      dep[l[k].ed]:=dep[t]+<span class="number">1</span>;</span><br><span class="line">      dfs(l[k].ed,t);</span><br><span class="line">      fa[l[k].ed]:=t;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    k:=l[k].pre;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  inc(tot);</span><br><span class="line">  pr[t]:=tot;</span><br><span class="line">  modify(tot,st[t]);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  readln(n);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">read</span>(st[i]);</span><br><span class="line">  tot:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n-<span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    readln(a,b);</span><br><span class="line">    link(a,b);</span><br><span class="line">    link(b,a);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  tot:=<span class="number">0</span>;</span><br><span class="line">  readln(q);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> q <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    readln(ch,x[i],y[i]);</span><br><span class="line">    ask[i]:=(ch=<span class="string">'Q'</span>);</span><br><span class="line">    <span class="keyword">if</span> ch=<span class="string">'Q'</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      link_(x[i],y[i]);</span><br><span class="line">      link_(y[i],x[i]);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  tot:=<span class="number">0</span>;</span><br><span class="line">  dfs(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> q <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> ask[i] <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      t:=query(pl[x[i]]) xor query(pl[y[i]]) xor st[lca[i]];</span><br><span class="line">      <span class="keyword">if</span> t=<span class="number">0</span> <span class="keyword">then</span> writeln(<span class="string">'No'</span>) <span class="keyword">else</span> writeln(<span class="string">'Yes'</span>);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      modify(pl[x[i]],st[x[i]] xor y[i]);</span><br><span class="line">      modify(pr[x[i]]+<span class="number">1</span>,st[x[i]] xor y[i]);</span><br><span class="line">      st[x[i]]:=y[i];</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;a href=&quot;http://www.lydsy.com/JudgeOnline/problem.php?id=2819&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;传送门&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;又是一道感人肺腑的题
      
    
    </summary>
    
      <category term="BZOJ" scheme="http://platypuspro.github.io/categories/BZOJ/"/>
    
    
      <category term="Game Theory" scheme="http://platypuspro.github.io/tags/Game-Theory/"/>
    
  </entry>
  
  <entry>
    <title>BZOJ 2242</title>
    <link href="http://platypuspro.github.io/posts/bzoj-2242/"/>
    <id>http://platypuspro.github.io/posts/bzoj-2242/</id>
    <published>2015-06-09T07:46:28.000Z</published>
    <updated>2015-06-09T09:12:48.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=2242" target="_blank" rel="noopener">传送门</a></p><p>尼玛每次BSGS忘了清空哈希一直冲突搞了我一上午 <del>然而还是会冲突，所以要拉链…</del></p><p>第一问…直接快速幂</p><p>第二问…费马小定理，所以快速幂 <del>因为我又忘了扩展欧几里得怎么写啊QAQ</del></p><p>第三问…BSGS，搞法如下</p><p>设$m=\lceil sqrt(p)\rceil,x=i\times m+j,j\in[0,m)$</p><p>$Y^x=Y^{i\times m+j}$</p><p>$Y^{i\times m+j}\equiv Z(mod\ p)$</p><p>$Y^j\equiv Z\times Y^{-i\times m}(mod\ p)$</p><p>处理出来$j\in[1,m)$的所有$Y^j$，存到哈希表里，然后枚举后面那一坨中的$i$，若哈希表中出现过就输出答案跳出</p><p>那么问题来了，求$Y^m$逆元技术哪家强？</p><p>它的逆元即为$(Y^m)^{p-2}$</p><p>$(Y^m)^{p-2}=Y^{m\times(p-2)}$</p><p>因为$p$为质数，由欧拉定理得$Y^{m\times(p-2)}=Y^{(m\times(p-2))mod\ \varphi(p)}=Y^{(m\times(p-2))mod\ (p-1)}=Y^{(m\times(p-1)-m)mod\ (p-1)}=Y^{p-m-1}$</p><p>这样就能求后面那一项了</p><p>我的哈希不拉链会冲突 = = 没有map的P党你们伤不起啊QAQ</p><p><i class="fa fa-code fa-2x"></i><br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">program</span> bzoj_2242;</span><br><span class="line"><span class="keyword">const</span> mo=<span class="number">100007</span>;</span><br><span class="line"><span class="keyword">var</span> t,k,i:longint;</span><br><span class="line">    y,z,p:int64;</span><br><span class="line">    h:<span class="keyword">array</span>[<span class="number">0</span>..mo,<span class="number">1</span>..<span class="number">2</span>]<span class="keyword">of</span> <span class="keyword">record</span> p:longint; k:int64; <span class="keyword">end</span>;</span><br><span class="line">    cnt:<span class="keyword">array</span>[<span class="number">0</span>..mo]<span class="keyword">of</span> longint;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mul</span><span class="params">(a,b:int64)</span>:</span>int64;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  mul:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> b&gt;<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> b <span class="keyword">and</span> <span class="number">1</span>=<span class="number">1</span> <span class="keyword">then</span> mul:=(mul+a)<span class="keyword">mod</span> p;</span><br><span class="line">    a:=a&lt;&lt;<span class="number">1</span> <span class="keyword">mod</span> p;</span><br><span class="line">    b:=b&gt;&gt;<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">qpower</span><span class="params">(x,k:int64)</span>:</span>int64;</span><br><span class="line"><span class="keyword">var</span> ans:int64;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  ans:=<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> k&gt;<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> k <span class="keyword">and</span> <span class="number">1</span>=<span class="number">1</span> <span class="keyword">then</span> ans:=mul(ans,x);</span><br><span class="line">    x:=mul(x,x);</span><br><span class="line">    k:=k&gt;&gt;<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">exit</span>(ans);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hash</span><span class="params">(x:int64)</span>:</span>longint;</span><br><span class="line"><span class="keyword">var</span> h:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  h:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> x&gt;<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    h:=(h*<span class="number">31</span>+x <span class="keyword">mod</span> <span class="number">10</span>)<span class="keyword">mod</span> mo;</span><br><span class="line">    x:=x <span class="keyword">div</span> <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">exit</span>(h);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">BSGS</span>;</span></span><br><span class="line"><span class="keyword">var</span> m,t,yy,zz:int64;</span><br><span class="line">    i,j,s:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  fillchar(cnt,sizeof(cnt),<span class="number">0</span>);</span><br><span class="line">  m:=trunc(sqrt(p)+<span class="number">1</span>-(<span class="number">1</span>e-<span class="number">3</span>));</span><br><span class="line">  t:=<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m-<span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    t:=mul(t,y);</span><br><span class="line">    s:=hash(t);</span><br><span class="line">    inc(cnt[s]);</span><br><span class="line">    h[s,cnt[s]].p:=i;</span><br><span class="line">    h[s,cnt[s]].k:=t;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  yy:=qpower(y,p-m-<span class="number">1</span>);</span><br><span class="line">  zz:=z;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> m-<span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    s:=hash(zz);</span><br><span class="line">    <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> cnt[s] <span class="keyword">do</span> <span class="keyword">if</span> h[s,j].k=zz <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      writeln(m*i+h[s,j].p);</span><br><span class="line">      <span class="keyword">exit</span>;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    zz:=mul(zz,yy);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  writeln(<span class="string">'Orz, I cannot find x!'</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  readln(t,k);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> t <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    readln(y,z,p);</span><br><span class="line">    <span class="keyword">if</span> k=<span class="number">1</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      writeln(qpower(y,z));</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    y:=y <span class="keyword">mod</span> p;</span><br><span class="line">    z:=z <span class="keyword">mod</span> p;</span><br><span class="line">    <span class="keyword">if</span> (y=<span class="number">0</span>)<span class="keyword">and</span>(z&lt;&gt;<span class="number">0</span>) <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      writeln(<span class="string">'Orz, I cannot find x!'</span>);</span><br><span class="line">      <span class="keyword">continue</span>;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">if</span> k=<span class="number">2</span> <span class="keyword">then</span> writeln(mul(qpower(y,p-<span class="number">2</span>),z));</span><br><span class="line">    <span class="keyword">if</span> k=<span class="number">3</span> <span class="keyword">then</span> <span class="keyword">if</span> y=<span class="number">0</span> <span class="keyword">then</span> writeln(<span class="string">'1'</span>) <span class="keyword">else</span> BSGS;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;a href=&quot;http://www.lydsy.com/JudgeOnline/problem.php?id=2242&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;传送门&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;尼玛每次BSGS忘了
      
    
    </summary>
    
      <category term="BZOJ" scheme="http://platypuspro.github.io/categories/BZOJ/"/>
    
    
      <category term="Math" scheme="http://platypuspro.github.io/tags/Math/"/>
    
      <category term="BSGS" scheme="http://platypuspro.github.io/tags/BSGS/"/>
    
  </entry>
  
  <entry>
    <title>BZOJ 4105</title>
    <link href="http://platypuspro.github.io/posts/bzoj-4105/"/>
    <id>http://platypuspro.github.io/posts/bzoj-4105/</id>
    <published>2015-06-09T07:46:19.000Z</published>
    <updated>2017-11-26T06:38:24.340Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=4105" target="_blank" rel="noopener">不稳定的传送门</a></p><h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><p>现有一个长度为$N$的序列$ \lbrace X_1,X_2,…,X_N\rbrace $，要求支持两种操作：<br>$1.\ 0\ l\ r$  表示将$\forall i\in [l,r],X_i = X_i^2\ {\rm mod}\ p$<br>$2.\ 1\ l\ r$  询问$\sum_{l\leq i\leq r}X_i$</p><h3 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h3><p>第一行有三个整数$N，M，p$，分别代表序列的长度、平方操作与询问操作的总次数以及在平方操作中所要模的数。<br>接下来一行$N$个数代表一开始的序列$\lbrace X_1,X_2,…,X_N\rbrace $。<br>接下来$M$行，每行三个整数$op,l,r$。其中$op$代表本次操作的类型。若$op=0$，代表这是一次平方操作，平方的区间为$[l,r]$；如果$op=1$，代表这是一次询问操作，询问的区间为$[l,r]$。</p><h3 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h3><p>对于每次的询问操作，输出一行代表这段区间内数的总和。注意：答案没有对任何数取模。</p><h3 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">3 3 11</span><br><span class="line">1 2 3</span><br><span class="line">1 1 3</span><br><span class="line">0 1 3</span><br><span class="line">1 1 3</span><br></pre></td></tr></table></figure><h3 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">6</span><br><span class="line">14</span><br></pre></td></tr></table></figure><h3 id="Hint"><a href="#Hint" class="headerlink" title="Hint"></a>Hint</h3><p>对于$100\%$的数据，保证$\forall i, X_i\in[0, P)$, $l, r\in[1, n]$</p><table><thead><tr><th style="text-align:center">测试点</th><th style="text-align:center">N</th><th style="text-align:center">M</th><th style="text-align:center">P</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">$\leq 1000$</td><td style="text-align:center">$\leq 1000$</td><td style="text-align:center">$=233$</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">$\leq 1000$</td><td style="text-align:center">$\leq 1000$</td><td style="text-align:center">$=2332$</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">$\leq 100000$</td><td style="text-align:center">$\leq 100000$</td><td style="text-align:center">$=5$</td></tr><tr><td style="text-align:center">4</td><td style="text-align:center">$\leq 100000$</td><td style="text-align:center">$\leq 100000$</td><td style="text-align:center">$=8192$</td></tr><tr><td style="text-align:center">5</td><td style="text-align:center">$\leq 100000$</td><td style="text-align:center">$\leq 100000$</td><td style="text-align:center">$=23$</td></tr><tr><td style="text-align:center">6</td><td style="text-align:center">$\leq 100000$</td><td style="text-align:center">$\leq 100000$</td><td style="text-align:center">$=45$</td></tr><tr><td style="text-align:center">7</td><td style="text-align:center">$\leq 100000$</td><td style="text-align:center">$\leq 100000$</td><td style="text-align:center">$=37$</td></tr><tr><td style="text-align:center">8</td><td style="text-align:center">$\leq 55000$</td><td style="text-align:center">$\leq 55000$</td><td style="text-align:center">$=4185$</td></tr><tr><td style="text-align:center">9</td><td style="text-align:center">$\leq 55000$</td><td style="text-align:center">$\leq 55000$</td><td style="text-align:center">$=5850$</td></tr><tr><td style="text-align:center">10</td><td style="text-align:center">$\leq 55000$</td><td style="text-align:center">$\leq 55000$</td><td style="text-align:center">$=2975$</td></tr><tr><td style="text-align:center">11</td><td style="text-align:center">$\leq 55000$</td><td style="text-align:center">$\leq 55000$</td><td style="text-align:center">$=2542$</td></tr><tr><td style="text-align:center">12</td><td style="text-align:center">$\leq 55000$</td><td style="text-align:center">$\leq 55000$</td><td style="text-align:center">$=2015$</td></tr><tr><td style="text-align:center">13</td><td style="text-align:center">$\leq 60000$</td><td style="text-align:center">$\leq 60000$</td><td style="text-align:center">$=2003$</td></tr><tr><td style="text-align:center">14</td><td style="text-align:center">$\leq 65000$</td><td style="text-align:center">$\leq 65000$</td><td style="text-align:center">$=2010$</td></tr><tr><td style="text-align:center">15</td><td style="text-align:center">$\leq 70000$</td><td style="text-align:center">$\leq 70000$</td><td style="text-align:center">$=4593$</td></tr><tr><td style="text-align:center">16</td><td style="text-align:center">$\leq 75000$</td><td style="text-align:center">$\leq 75000$</td><td style="text-align:center">$=4562$</td></tr><tr><td style="text-align:center">17</td><td style="text-align:center">$\leq 80000$</td><td style="text-align:center">$\leq 80000$</td><td style="text-align:center">$=1034$</td></tr><tr><td style="text-align:center">18</td><td style="text-align:center">$\leq 85000$</td><td style="text-align:center">$\leq 85000$</td><td style="text-align:center">$=5831$</td></tr><tr><td style="text-align:center">19</td><td style="text-align:center">$\leq 90000$</td><td style="text-align:center">$\leq 90000$</td><td style="text-align:center">$=9905$</td></tr><tr><td style="text-align:center">20</td><td style="text-align:center">$\leq 100000$</td><td style="text-align:center">$\leq 100000$</td><td style="text-align:center">$=9977$</td></tr></tbody></table><p>在模意义下，任何数字一直平方都会进入$\rho$或$O$型循环</p><p>打表可以发现这些模数的所有循环节长度的${\rm LCM}$都是$\leq 60$的（本来想贴上每个的长度的…发现打表的程序删了T T）</p><p>那么线段树中每个节点维护一个环，修改时转一下就行了</p><p>注意$\rho$型循环中还没真正进入循环（也就是还在柄上）的情况，还没进循环时先不存，等转进循环时再算</p><p>先处理出$[0,p-1]$中真正在循环中的数，然后建树，线段树合并时长度取左右儿子长度的${\rm LCM}$，环上每个点的数值取左右儿子这一位的和</p><p>别的操作自行YY即可</p><p>顺便贴一发<a href="http://zyk1997.github.io/2015/06/04/THOI2015/" target="_blank" rel="noopener">题解</a>…</p><p><i class="fa fa-code fa-2x"></i><br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">program</span> bzoj_4105;</span><br><span class="line"><span class="keyword">type</span> circ=<span class="keyword">record</span> nxt,k:longint; <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">var</span> s:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">200000</span>]<span class="keyword">of</span> <span class="keyword">record</span> l,r,len,sum,lc,rc,mk,cir:longint; <span class="keyword">end</span>;</span><br><span class="line">    n,m,mo,i,op,l,r,tot,rt,cir:longint;</span><br><span class="line">    v:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">10000</span>]<span class="keyword">of</span> longint;</span><br><span class="line">    incir:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">10000</span>]<span class="keyword">of</span> boolean;</span><br><span class="line">    x:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">100000</span>]<span class="keyword">of</span> longint;</span><br><span class="line">    c:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">12000000</span>]<span class="keyword">of</span> circ;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gcd</span><span class="params">(a,b:longint)</span>:</span>longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">if</span> b=<span class="number">0</span> <span class="keyword">then</span> <span class="keyword">exit</span>(a) <span class="keyword">else</span> <span class="keyword">exit</span>(gcd(b,a <span class="keyword">mod</span> b));</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">find_cir</span><span class="params">(x:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> t:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">if</span> v[x]&lt;&gt;<span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> v[x]=tot <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      t:=x;</span><br><span class="line">      <span class="keyword">repeat</span></span><br><span class="line">        incir[t]:=true;</span><br><span class="line">        t:=t*t <span class="keyword">mod</span> mo;</span><br><span class="line">      <span class="keyword">until</span> t=x;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  v[x]:=tot;</span><br><span class="line">  find_cir(x*x <span class="keyword">mod</span> mo);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">get_cir</span><span class="params">(<span class="keyword">var</span> p,len:longint;k:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> st,t:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  len:=<span class="number">1</span>;</span><br><span class="line">  inc(cir);</span><br><span class="line">  p:=cir;</span><br><span class="line">  c[p].k:=k;</span><br><span class="line">  st:=p;</span><br><span class="line">  t:=k*k <span class="keyword">mod</span> mo;</span><br><span class="line">  <span class="keyword">while</span> t&lt;&gt;k <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    inc(len);</span><br><span class="line">    inc(cir);</span><br><span class="line">    c[p].nxt:=cir;</span><br><span class="line">    p:=c[p].nxt;</span><br><span class="line">    c[p].k:=t;</span><br><span class="line">    t:=t*t <span class="keyword">mod</span> mo;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  c[p].nxt:=st;</span><br><span class="line">  p:=st;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">add</span><span class="params">(<span class="keyword">var</span> t:longint;c1,c2,len:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> i,st,p:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  inc(cir);</span><br><span class="line">  t:=cir;</span><br><span class="line">  st:=cir;</span><br><span class="line">  p:=st;</span><br><span class="line">  c[cir].k:=c[c1].k+c[c2].k;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> len-<span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    inc(cir);</span><br><span class="line">    c[p].nxt:=cir;</span><br><span class="line">    p:=cir;</span><br><span class="line">    c1:=c[c1].nxt;</span><br><span class="line">    c2:=c[c2].nxt;</span><br><span class="line">    c[p].k:=c[c1].k+c[c2].k;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  c[p].nxt:=st;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">merge</span><span class="params">(t,c1,c2,len:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> i:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> len <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    c[t].k:=c[c1].k+c[c2].k;</span><br><span class="line">    t:=c[t].nxt;</span><br><span class="line">    c1:=c[c1].nxt;</span><br><span class="line">    c2:=c[c2].nxt;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">update</span><span class="params">(t:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> ll,rl:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  s[t].sum:=s[s[t].lc].sum+s[s[t].rc].sum;</span><br><span class="line">  ll:=s[s[t].lc].len;</span><br><span class="line">  rl:=s[s[t].rc].len;</span><br><span class="line">  <span class="keyword">if</span> (s[t].len=<span class="number">0</span>)<span class="keyword">and</span>(ll&lt;&gt;<span class="number">0</span>)<span class="keyword">and</span>(rl&lt;&gt;<span class="number">0</span>) <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    s[t].len:=ll*rl <span class="keyword">div</span> gcd(ll,rl);</span><br><span class="line">    add(s[t].cir,s[s[t].lc].cir,s[s[t].rc].cir,s[t].len);</span><br><span class="line">  <span class="keyword">end</span> <span class="keyword">else</span> merge(s[t].cir,s[s[t].lc].cir,s[s[t].rc].cir,s[t].len);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">build</span><span class="params">(<span class="keyword">var</span> t:longint;l,r:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> mid:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  inc(tot);</span><br><span class="line">  t:=tot;</span><br><span class="line">  s[t].lc:=<span class="number">0</span>;</span><br><span class="line">  s[t].rc:=<span class="number">0</span>;</span><br><span class="line">  s[t].sum:=<span class="number">0</span>;</span><br><span class="line">  s[t].len:=<span class="number">0</span>;</span><br><span class="line">  s[t].mk:=<span class="number">0</span>;</span><br><span class="line">  s[t].l:=l;</span><br><span class="line">  s[t].r:=r;</span><br><span class="line">  <span class="keyword">if</span> l=r <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> incir[x[l]] <span class="keyword">then</span> get_cir(s[t].cir,s[t].len,x[l]);</span><br><span class="line">    s[t].sum:=x[l];</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  mid:=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">  build(s[t].lc,l,mid);</span><br><span class="line">  build(s[t].rc,mid+<span class="number">1</span>,r);</span><br><span class="line">  update(t);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">rotate</span><span class="params">(t,d:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> i:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">if</span> t=<span class="number">0</span> <span class="keyword">then</span> <span class="keyword">exit</span>;</span><br><span class="line">  d:=d <span class="keyword">mod</span> s[t].len;</span><br><span class="line">  inc(s[t].mk,d);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> d <span class="keyword">do</span> s[t].cir:=c[s[t].cir].nxt;</span><br><span class="line">  s[t].sum:=c[s[t].cir].k;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">pushdown</span><span class="params">(t:longint)</span>;</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">if</span> s[t].mk=<span class="number">0</span> <span class="keyword">then</span> <span class="keyword">exit</span>;</span><br><span class="line">  rotate(s[t].lc,s[t].mk);</span><br><span class="line">  rotate(s[t].rc,s[t].mk);</span><br><span class="line">  s[t].mk:=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">modify</span><span class="params">(t,l,r:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> mid:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">if</span> s[t].mk&lt;&gt;<span class="number">0</span> <span class="keyword">then</span> pushdown(t);</span><br><span class="line">  <span class="keyword">if</span> (l&lt;=s[t].l)<span class="keyword">and</span>(r&gt;=s[t].r) <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> s[t].len&lt;&gt;<span class="number">0</span> <span class="keyword">then</span> rotate(t,<span class="number">1</span>) <span class="keyword">else</span> <span class="keyword">if</span> s[t].l=s[t].r <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      s[t].sum:=sqr(s[t].sum)<span class="keyword">mod</span> mo;</span><br><span class="line">      <span class="keyword">if</span> incir[s[t].sum] <span class="keyword">then</span> get_cir(s[t].cir,s[t].len,s[t].sum);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      modify(s[t].lc,l,r);</span><br><span class="line">      modify(s[t].rc,l,r);</span><br><span class="line">      update(t);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  mid:=(s[t].l+s[t].r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> l&lt;=mid <span class="keyword">then</span> modify(s[t].lc,l,r);</span><br><span class="line">  <span class="keyword">if</span> r&gt;mid <span class="keyword">then</span> modify(s[t].rc,l,r);</span><br><span class="line">  update(t);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">query</span><span class="params">(t,l,r:longint)</span>:</span>longint;</span><br><span class="line"><span class="keyword">var</span> mid:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">if</span> s[t].mk&lt;&gt;<span class="number">0</span> <span class="keyword">then</span> pushdown(t);</span><br><span class="line">  <span class="keyword">if</span> (l&lt;=s[t].l)<span class="keyword">and</span>(r&gt;=s[t].r) <span class="keyword">then</span> <span class="keyword">exit</span>(s[t].sum);</span><br><span class="line">  mid:=(s[t].l+s[t].r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">  query:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> l&lt;=mid <span class="keyword">then</span> inc(query,query(s[t].lc,l,r));</span><br><span class="line">  <span class="keyword">if</span> r&gt;mid <span class="keyword">then</span> inc(query,query(s[t].rc,l,r));</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  readln(n,m,mo);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> mo-<span class="number">1</span> <span class="keyword">do</span> incir[i]:=false;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> mo-<span class="number">1</span> <span class="keyword">do</span> v[i]:=<span class="number">0</span>;</span><br><span class="line">  tot:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> mo-<span class="number">1</span> <span class="keyword">do</span> <span class="keyword">if</span> v[i]=<span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    inc(tot);</span><br><span class="line">    find_cir(i);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">read</span>(x[i]);</span><br><span class="line">  tot:=<span class="number">0</span>;</span><br><span class="line">  cir:=<span class="number">0</span>;</span><br><span class="line">  build(rt,<span class="number">1</span>,n);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    readln(op,l,r);</span><br><span class="line">    <span class="keyword">if</span> op=<span class="number">0</span> <span class="keyword">then</span> modify(<span class="number">1</span>,l,r) <span class="keyword">else</span> writeln(query(<span class="number">1</span>,l,r));</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;a href=&quot;http://www.lydsy.com/JudgeOnline/problem.php?id=4105&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;不稳定的传送门&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;D
      
    
    </summary>
    
      <category term="BZOJ" scheme="http://platypuspro.github.io/categories/BZOJ/"/>
    
    
      <category term="Segment Tree" scheme="http://platypuspro.github.io/tags/Segment-Tree/"/>
    
  </entry>
  
  <entry>
    <title>BZOJ 4103</title>
    <link href="http://platypuspro.github.io/posts/bzoj-4103/"/>
    <id>http://platypuspro.github.io/posts/bzoj-4103/</id>
    <published>2015-06-09T07:46:14.000Z</published>
    <updated>2017-11-26T06:38:15.756Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=4103" target="_blank" rel="noopener">不稳定的传送门</a></p><h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><p>给定长度为$n$的数列$ X = \lbrace x_1,x_2,…,x_n\rbrace $和长度为$m$的数列$Y=\lbrace y_1,y_2,…,y_m\rbrace $，令矩阵$A$中第$i$行第$j$列的值$A_{ij}=x_i\bigoplus y_j$，每次询问给定矩形区域$i\in[u,d],j\in[l,r]$，找出第$k$大的$A_{ij}$。</p><h3 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h3><p>第一行包含两个正整数$n,m$，分别表示两个数列的长度<br>第二行包含$n$个非负整数$x_i$<br>第三行包含$m$个非负整数$y_j$<br>第四行包含一个正整数$p$，表示询问次数<br>随后$p$行，每行均包含$5$个正整数，用来描述一次询问，每行包含五个正整数$u,d,l,r,k$，含义如题意所述。</p><h3 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h3><p>共$p$行，每行包含一个非负整数，表示此次询问的答案。</p><h3 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">3 3</span><br><span class="line">1 2 4</span><br><span class="line">7 6 5</span><br><span class="line">3</span><br><span class="line">1 2 1 2 2</span><br><span class="line">1 2 1 3 4</span><br><span class="line">2 3 2 3 4</span><br></pre></td></tr></table></figure><h3 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">6</span><br><span class="line">5</span><br><span class="line">1</span><br></pre></td></tr></table></figure><h3 id="Hint"><a href="#Hint" class="headerlink" title="Hint"></a>Hint</h3><p>对于$100\%$的数据，$0&lt;=X_i,Y_j&lt;2^{31}$,<br>$1\leq u\leq d\leq n\leq 1000$,<br>$1\leq l\leq r\leq m\leq 300000$,<br>$1\leq k\leq (d-u+1)*(r-l+1)$,<br>$1\leq p\leq 500$</p><p>按照$m$这一维度建可持久化Trie</p><p>每个询问中的每个$n$维度的点单独决定是走$1$还是走$0$，找第$k$大的方法直接仿照找别的树第$k$大那样就行了</p><p>刚开始总想把$n$维度的点都合在一起找，后来发现不行的说</p><p><i class="fa fa-code fa-2x"></i><br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">program</span> bzoj_4103;</span><br><span class="line"><span class="keyword">const</span> log=<span class="number">31</span>;</span><br><span class="line"><span class="keyword">var</span> s:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">9900000</span>]<span class="keyword">of</span> <span class="keyword">record</span> son:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1</span>]<span class="keyword">of</span> longint; size:longint; <span class="keyword">end</span>;</span><br><span class="line">    root:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">300000</span>]<span class="keyword">of</span> longint;</span><br><span class="line">    n,m,i,j,tot,p,b,x1,y1,x2,y2,k,len:longint;</span><br><span class="line">    a:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">1000</span>]<span class="keyword">of</span> longint;</span><br><span class="line">    seq:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">1000</span>]<span class="keyword">of</span> <span class="keyword">record</span> l,r,k:longint; <span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">insert</span><span class="params">(<span class="keyword">var</span> t:longint;st,pos,base:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> x:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  inc(tot);</span><br><span class="line">  t:=tot;</span><br><span class="line">  s[t]:=s[base];</span><br><span class="line">  inc(s[t].size);</span><br><span class="line">  <span class="keyword">if</span> pos&lt;<span class="number">0</span> <span class="keyword">then</span> <span class="keyword">exit</span>;</span><br><span class="line">  x:=st&gt;&gt;pos <span class="keyword">and</span> <span class="number">1</span>;</span><br><span class="line">  insert(s[t].son[x],st,pos-<span class="number">1</span>,s[base].son[x]);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">query</span><span class="params">(pos,k:longint)</span>:</span>longint;</span><br><span class="line"><span class="keyword">var</span> i,x,cnt,t:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">if</span> pos&lt;<span class="number">0</span> <span class="keyword">then</span> <span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">  cnt:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> len <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    x:=(seq[i].k&gt;&gt;pos <span class="keyword">and</span> <span class="number">1</span>)xor <span class="number">1</span>;</span><br><span class="line">    inc(cnt,s[s[seq[i].r].son[x]].size-s[s[seq[i].l].son[x]].size);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  t:=ord(k&lt;=cnt);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> len <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    x:=(seq[i].k&gt;&gt;pos <span class="keyword">and</span> <span class="number">1</span>)xor t;</span><br><span class="line">    seq[i].l:=s[seq[i].l].son[x];</span><br><span class="line">    seq[i].r:=s[seq[i].r].son[x];</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">exit</span>(t&lt;&lt;pos <span class="keyword">or</span> query(pos-<span class="number">1</span>,k-(t xor <span class="number">1</span>)*cnt));</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  readln(n,m);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">read</span>(a[i]);</span><br><span class="line">  tot:=<span class="number">0</span>;</span><br><span class="line">  root[<span class="number">0</span>]:=<span class="number">0</span>;</span><br><span class="line">  s[<span class="number">0</span>].son[<span class="number">0</span>]:=<span class="number">0</span>;</span><br><span class="line">  s[<span class="number">0</span>].son[<span class="number">1</span>]:=<span class="number">0</span>;</span><br><span class="line">  s[<span class="number">0</span>].size:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">read</span>(b);</span><br><span class="line">    insert(root[i],b,log,root[i-<span class="number">1</span>]);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  readln(p);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> p <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    readln(x1,x2,y1,y2,k);</span><br><span class="line">    len:=x2-x1+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> j:=x1 <span class="keyword">to</span> x2 <span class="keyword">do</span> <span class="keyword">with</span> seq[j-x1+<span class="number">1</span>] <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      l:=root[y1-<span class="number">1</span>];</span><br><span class="line">      r:=root[y2];</span><br><span class="line">      k:=a[j];</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    writeln(query(log,k));</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;a href=&quot;http://www.lydsy.com/JudgeOnline/problem.php?id=4103&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;不稳定的传送门&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;D
      
    
    </summary>
    
      <category term="BZOJ" scheme="http://platypuspro.github.io/categories/BZOJ/"/>
    
    
      <category term="Persistent Trie" scheme="http://platypuspro.github.io/tags/Persistent-Trie/"/>
    
  </entry>
  
  <entry>
    <title>BZOJ 3261</title>
    <link href="http://platypuspro.github.io/posts/bzoj-3261/"/>
    <id>http://platypuspro.github.io/posts/bzoj-3261/</id>
    <published>2015-06-05T03:15:31.000Z</published>
    <updated>2015-07-10T09:21:30.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=3261" target="_blank" rel="noopener">不稳定的传送门</a></p><p>设$b[i]=a[1] \oplus a[2] \oplus \cdots \oplus a[i-1],b[1]=0$</p><p>$a[i] \oplus a[i+1] \oplus \cdots \oplus a[n] \oplus x=b[i] \oplus b[n+1] \oplus x$</p><p>后面的$b[n+1] \oplus x$是定值，所以题目就成了求$[l,r]$中使上面的式子最大的$i$</p><p>因为求的是最大，所以在可持久化Trie中往下走时，先看当前这一位能不能为$1$，能为$1$就走儿子$1$，否则走儿子$0$</p><p><i class="fa fa-code fa-2x"></i><br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">program</span> bzoj_3261;</span><br><span class="line"><span class="keyword">const</span> log=<span class="number">23</span>;</span><br><span class="line"><span class="keyword">var</span> s:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">7500000</span>*<span class="number">2</span>]<span class="keyword">of</span> <span class="keyword">record</span> son:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">1</span>]<span class="keyword">of</span> longint; size:longint; <span class="keyword">end</span>;</span><br><span class="line">    n,m,i,a,x,tot,l,r:longint;</span><br><span class="line">    b,root:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">600001</span>]<span class="keyword">of</span> longint;</span><br><span class="line">    c:char;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">insert</span><span class="params">(<span class="keyword">var</span> t:longint;st,pos,base:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> x:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  inc(tot);</span><br><span class="line">  t:=tot;</span><br><span class="line">  s[t]:=s[base];</span><br><span class="line">  inc(s[t].size);</span><br><span class="line">  <span class="keyword">if</span> pos&lt;<span class="number">0</span> <span class="keyword">then</span> <span class="keyword">exit</span>;</span><br><span class="line">  x:=st&gt;&gt;pos <span class="keyword">and</span> <span class="number">1</span>;</span><br><span class="line">  insert(s[t].son[x],st,pos-<span class="number">1</span>,s[base].son[x]);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">query</span><span class="params">(t1,t2,pos,st:longint)</span>:</span>longint;</span><br><span class="line"><span class="keyword">var</span> x,y:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">if</span> pos&lt;<span class="number">0</span> <span class="keyword">then</span> <span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">  x:=((st&gt;&gt;pos)<span class="keyword">and</span> <span class="number">1</span>)xor <span class="number">1</span>;</span><br><span class="line">  y:=x xor <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> s[s[t2].son[x]].size=s[s[t1].son[x]].size <span class="keyword">then</span> x:=x xor <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">exit</span>((x xor y)&lt;&lt;pos+query(s[t1].son[x],s[t2].son[x],pos-<span class="number">1</span>,st));</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  readln(n,m);</span><br><span class="line">  b[<span class="number">1</span>]:=<span class="number">0</span>;</span><br><span class="line">  inc(n);</span><br><span class="line">  tot:=<span class="number">0</span>;</span><br><span class="line">  s[<span class="number">0</span>].son[<span class="number">0</span>]:=<span class="number">0</span>;</span><br><span class="line">  s[<span class="number">0</span>].son[<span class="number">1</span>]:=<span class="number">0</span>;</span><br><span class="line">  s[<span class="number">0</span>].size:=<span class="number">0</span>;</span><br><span class="line">  insert(root[<span class="number">1</span>],<span class="number">0</span>,log,<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">2</span> <span class="keyword">to</span> n <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">read</span>(a);</span><br><span class="line">    b[i]:=b[i-<span class="number">1</span>] xor a;</span><br><span class="line">    insert(root[i],b[i],log,root[i-<span class="number">1</span>]);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  readln;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">read</span>(c);</span><br><span class="line">    <span class="keyword">if</span> c=<span class="string">'A'</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      readln(a);</span><br><span class="line">      inc(n);</span><br><span class="line">      b[n]:=b[n-<span class="number">1</span>]xor a;</span><br><span class="line">      insert(root[n],b[n],log,root[n-<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      readln(l,r,x);</span><br><span class="line">      writeln(query(root[l-<span class="number">1</span>],root[r],log,b[n] xor x));</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;a href=&quot;http://www.lydsy.com/JudgeOnline/problem.php?id=3261&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;不稳定的传送门&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;设$b[i]
      
    
    </summary>
    
      <category term="BZOJ" scheme="http://platypuspro.github.io/categories/BZOJ/"/>
    
    
      <category term="Persistent Trie" scheme="http://platypuspro.github.io/tags/Persistent-Trie/"/>
    
  </entry>
  
  <entry>
    <title>BZOJ 1026</title>
    <link href="http://platypuspro.github.io/posts/bzoj-1026/"/>
    <id>http://platypuspro.github.io/posts/bzoj-1026/</id>
    <published>2015-06-05T03:15:21.000Z</published>
    <updated>2015-06-09T07:53:12.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=1026" target="_blank" rel="noopener">传送门</a></p><p>Orz <a href="http://zyk1997.github.io/2015/03/20/ShuWeiDP/" target="_blank" rel="noopener">ZYK</a></p><p>数位DP过程中记录下上一位是啥，然后…不会了TAT 还是去戳上面那篇大爷的题解吧 = =</p><p><i class="fa fa-code fa-2x"></i><br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">program</span> bzoj_1026;</span><br><span class="line"><span class="keyword">var</span> d:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">10</span>]<span class="keyword">of</span> longint;</span><br><span class="line">    a,b:longint;</span><br><span class="line">    f:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">10</span>,<span class="number">0</span>..<span class="number">9</span>,<span class="number">0</span>..<span class="number">1</span>]<span class="keyword">of</span> longint;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dfs</span><span class="params">(p,pre:longint;flag,lim:boolean)</span>:</span>longint;</span><br><span class="line"><span class="keyword">var</span> limit,i:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">if</span> p&lt;<span class="number">1</span> <span class="keyword">then</span> <span class="keyword">exit</span>(ord(flag));</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">not</span> lim)<span class="keyword">and</span>(f[p,pre,ord(flag)]&lt;&gt;-<span class="number">1</span>) <span class="keyword">then</span> <span class="keyword">exit</span>(f[p,pre,ord(flag)]);</span><br><span class="line">  <span class="keyword">if</span> lim <span class="keyword">then</span> limit:=d[p] <span class="keyword">else</span> limit:=<span class="number">9</span>;</span><br><span class="line">  dfs:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> limit <span class="keyword">do</span> <span class="keyword">if</span> (abs(i-pre)&gt;=<span class="number">2</span>)<span class="keyword">or</span>(<span class="keyword">not</span> flag) <span class="keyword">then</span> inc(dfs,dfs(p-<span class="number">1</span>,i,flag <span class="keyword">or</span> (i&lt;&gt;<span class="number">0</span>),lim <span class="keyword">and</span>(i=limit)));</span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> lim <span class="keyword">then</span> f[p,pre,ord(flag)]:=dfs;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">solve</span><span class="params">(x:longint)</span>:</span>longint;</span><br><span class="line"><span class="keyword">var</span> len:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">if</span> x=<span class="number">0</span> <span class="keyword">then</span> <span class="keyword">exit</span>(<span class="number">0</span>);</span><br><span class="line">  len:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> x&gt;<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    inc(len);</span><br><span class="line">    d[len]:=x <span class="keyword">mod</span> <span class="number">10</span>;</span><br><span class="line">    x:=x <span class="keyword">div</span> <span class="number">10</span>;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  fillchar(f,sizeof(f),<span class="number">255</span>);</span><br><span class="line">  <span class="keyword">exit</span>(dfs(len,<span class="number">0</span>,false,true));</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  readln(a,b);</span><br><span class="line">  writeln(solve(b)-solve(a-<span class="number">1</span>));</span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;a href=&quot;http://www.lydsy.com/JudgeOnline/problem.php?id=1026&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;传送门&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Orz &lt;a hre
      
    
    </summary>
    
      <category term="BZOJ" scheme="http://platypuspro.github.io/categories/BZOJ/"/>
    
    
      <category term="Dynamic Programming" scheme="http://platypuspro.github.io/tags/Dynamic-Programming/"/>
    
  </entry>
  
  <entry>
    <title>BZOJ 3926</title>
    <link href="http://platypuspro.github.io/posts/bzoj-3926/"/>
    <id>http://platypuspro.github.io/posts/bzoj-3926/</id>
    <published>2015-06-05T03:15:16.000Z</published>
    <updated>2015-06-09T07:52:48.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=3926" target="_blank" rel="noopener">传送门</a></p><p>陈老师语文水平高超+1 2333</p><p><strong>太阳花田的结构比较特殊，只与一个空地相邻的空地数量不超过20个。</strong>（因为很重要所以再发一遍）</p><p>找到这20个叶子节点，然后DFS20遍，把遇到的节点扔到自动机里就行了</p><p><i class="fa fa-code fa-2x"></i><br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">program</span> bzoj_3926;</span><br><span class="line"><span class="keyword">const</span> maxn=<span class="number">100000</span>;</span><br><span class="line"><span class="keyword">var</span> n,c,i,tot,a,b,np,q,nq:longint;</span><br><span class="line">    mx,fa:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">2</span>*maxn*<span class="number">20</span>+<span class="number">1</span>]<span class="keyword">of</span> longint;</span><br><span class="line">    son:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">2</span>*maxn*<span class="number">20</span>+<span class="number">1</span>,<span class="number">0</span>..<span class="number">9</span>]<span class="keyword">of</span> longint;</span><br><span class="line">    l:<span class="keyword">array</span>[<span class="number">1</span>..maxn*<span class="number">2</span>]<span class="keyword">of</span> <span class="keyword">record</span> ed,pre:longint; <span class="keyword">end</span>;</span><br><span class="line">    lst,col,cnt:<span class="keyword">array</span>[<span class="number">1</span>..maxn]<span class="keyword">of</span> longint;</span><br><span class="line">    ans:int64;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">link</span><span class="params">(a,b:longint)</span>;</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  inc(tot);</span><br><span class="line">  l[tot].pre:=lst[a];</span><br><span class="line">  lst[a]:=tot;</span><br><span class="line">  l[tot].ed:=b;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">extend</span><span class="params">(p,c:longint)</span>:</span>longint;</span><br><span class="line"><span class="keyword">var</span> i:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  inc(tot);</span><br><span class="line">  np:=tot;</span><br><span class="line">  mx[np]:=mx[p]+<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (p&lt;&gt;<span class="number">0</span>)<span class="keyword">and</span>(son[p,c]=<span class="number">0</span>) <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    son[p,c]:=np;</span><br><span class="line">    p:=fa[p];</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">if</span> p=<span class="number">0</span> <span class="keyword">then</span> fa[np]:=<span class="number">1</span> <span class="keyword">else</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    q:=son[p,c];</span><br><span class="line">    <span class="keyword">if</span> mx[p]+<span class="number">1</span>=mx[q] <span class="keyword">then</span> fa[np]:=q <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      inc(tot);</span><br><span class="line">      nq:=tot;</span><br><span class="line">      <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> <span class="number">9</span> <span class="keyword">do</span> son[nq,i]:=son[q,i];</span><br><span class="line">      fa[nq]:=fa[q];</span><br><span class="line">      fa[q]:=nq;</span><br><span class="line">      fa[np]:=nq;</span><br><span class="line">      mx[nq]:=mx[p]+<span class="number">1</span>;</span><br><span class="line">      <span class="keyword">while</span> (p&lt;&gt;<span class="number">0</span>)<span class="keyword">and</span>(son[p,c]=q) <span class="keyword">do</span></span><br><span class="line">      <span class="keyword">begin</span></span><br><span class="line">        son[p,c]:=nq;</span><br><span class="line">        p:=fa[p];</span><br><span class="line">      <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">exit</span>(np);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">dfs</span><span class="params">(i,fa,p:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> k,np:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  np:=extend(p,col[i]);</span><br><span class="line">  k:=lst[i];</span><br><span class="line">  <span class="keyword">while</span> k&lt;&gt;<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> l[k].ed&lt;&gt;fa <span class="keyword">then</span> dfs(l[k].ed,i,np);</span><br><span class="line">    k:=l[k].pre;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  readln(n,c);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">read</span>(col[i]);</span><br><span class="line">  tot:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> cnt[i]:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n-<span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    readln(a,b);</span><br><span class="line">    link(a,b);</span><br><span class="line">    link(b,a);</span><br><span class="line">    inc(cnt[a]);</span><br><span class="line">    inc(cnt[b]);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  tot:=<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">if</span> cnt[i]=<span class="number">1</span> <span class="keyword">then</span> dfs(i,<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">  ans:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> tot <span class="keyword">do</span> inc(ans,mx[i]-mx[fa[i]]);</span><br><span class="line">  writeln(ans);</span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;a href=&quot;http://www.lydsy.com/JudgeOnline/problem.php?id=3926&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;传送门&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;陈老师语文水平高超+
      
    
    </summary>
    
      <category term="BZOJ" scheme="http://platypuspro.github.io/categories/BZOJ/"/>
    
    
      <category term="Suffix Automaton" scheme="http://platypuspro.github.io/tags/Suffix-Automaton/"/>
    
  </entry>
  
  <entry>
    <title>BZOJ 3993</title>
    <link href="http://platypuspro.github.io/posts/bzoj-3993/"/>
    <id>http://platypuspro.github.io/posts/bzoj-3993/</id>
    <published>2015-06-05T03:15:12.000Z</published>
    <updated>2015-06-09T02:56:06.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=3993" target="_blank" rel="noopener">传送门</a></p><p>二分答案，然后网络流验证是否可行</p><ul><li>源点向每个武器连容量为时间*攻击力的边</li><li>每个武器向能攻击的机器人连容量为攻击力的边</li><li>每个机器人向汇点连容量为血量的边</li></ul><p>若最大流=总血量则说明当前方案可行</p><p><del>刚开始用的数组直接赋值好慢好慢…所以改成每次重新连</del></p><p><i class="fa fa-code fa-2x"></i><br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">program</span> bzoj_3993;</span><br><span class="line"><span class="keyword">const</span> inf=maxlongint&gt;&gt;<span class="number">1</span>;</span><br><span class="line">      qs=<span class="number">5201</span>;</span><br><span class="line">      eps=<span class="number">1</span>e-<span class="number">3</span>;</span><br><span class="line"><span class="keyword">var</span> n,m,i,j,t,ss,tt,tot,tota,len:longint;</span><br><span class="line">    l:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">5201</span>]<span class="keyword">of</span> <span class="keyword">record</span> ed,pre:longint; f:extended; <span class="keyword">end</span>;</span><br><span class="line">    lst:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">102</span>]<span class="keyword">of</span> longint;</span><br><span class="line">    a,b:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">50</span>]<span class="keyword">of</span> longint;</span><br><span class="line">    lnk:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">50</span>,<span class="number">1</span>..<span class="number">50</span>]<span class="keyword">of</span> boolean;</span><br><span class="line">    q,d,seq:<span class="keyword">array</span>[<span class="number">1</span>..qs]<span class="keyword">of</span> longint;</span><br><span class="line">    ll,rr,mid,maxf:extended;</span><br><span class="line">    v:<span class="keyword">array</span>[<span class="number">1</span>..qs]<span class="keyword">of</span> boolean;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">link</span><span class="params">(a,b:longint;f:extended)</span>;</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  inc(tot);</span><br><span class="line">  l[tot].pre:=lst[a];</span><br><span class="line">  lst[a]:=tot;</span><br><span class="line">  l[tot].ed:=b;</span><br><span class="line">  l[tot].f:=f;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">insert</span><span class="params">(a,b:longint;f:extended)</span>;</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  link(a,b,f);</span><br><span class="line">  link(b,a,<span class="number">0</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bfs</span>:</span>boolean;</span><br><span class="line"><span class="keyword">var</span> hd,tl,k:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  hd:=<span class="number">0</span>;</span><br><span class="line">  tl:=<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> tt <span class="keyword">do</span> d[i]:=inf;</span><br><span class="line">  d[ss]:=<span class="number">0</span>;</span><br><span class="line">  q[<span class="number">1</span>]:=ss;</span><br><span class="line">  <span class="keyword">while</span> hd&lt;&gt;tl <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    hd:=hd <span class="keyword">mod</span> qs+<span class="number">1</span>;</span><br><span class="line">    k:=lst[q[hd]];</span><br><span class="line">    <span class="keyword">while</span> k&lt;&gt;<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      <span class="keyword">if</span> (l[k].f&gt;<span class="number">0</span>)<span class="keyword">and</span>(d[q[hd]]+<span class="number">1</span>&lt;d[l[k].ed]) <span class="keyword">then</span></span><br><span class="line">      <span class="keyword">begin</span></span><br><span class="line">        d[l[k].ed]:=d[q[hd]]+<span class="number">1</span>;</span><br><span class="line">        v[l[k].ed]:=true;</span><br><span class="line">        tl:=tl <span class="keyword">mod</span> qs+<span class="number">1</span>;</span><br><span class="line">        q[tl]:=l[k].ed;</span><br><span class="line">      <span class="keyword">end</span>;</span><br><span class="line">      k:=l[k].pre;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  fillchar(v,sizeof(v),false);</span><br><span class="line">  <span class="keyword">exit</span>(d[tt]&lt;inf);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">expand</span>;</span></span><br><span class="line"><span class="keyword">var</span> i:longint;</span><br><span class="line">    f:extended;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  f:=inf;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> len <span class="keyword">do</span> <span class="keyword">if</span> l[seq[i]].f&lt;f <span class="keyword">then</span> f:=l[seq[i]].f;</span><br><span class="line">  maxf:=maxf+f;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> len <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    l[seq[i]].f:=l[seq[i]].f-f;</span><br><span class="line">    l[seq[i] xor <span class="number">1</span>].f:=l[seq[i] xor <span class="number">1</span>].f+f;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">dfs</span><span class="params">(t:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> k:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  v[t]:=true;</span><br><span class="line">  <span class="keyword">if</span> t=tt <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    expand;</span><br><span class="line">    <span class="keyword">exit</span>;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  k:=lst[t];</span><br><span class="line">  <span class="keyword">while</span> k&lt;&gt;<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (l[k].f&gt;<span class="number">0</span>)<span class="keyword">and</span>(d[t]+<span class="number">1</span>=d[l[k].ed])<span class="keyword">and</span>(<span class="keyword">not</span> v[l[k].ed]) <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      inc(len);</span><br><span class="line">      seq[len]:=k;</span><br><span class="line">      dfs(l[k].ed);</span><br><span class="line">      dec(len);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    k:=l[k].pre;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  readln(n,m);</span><br><span class="line">  ss:=n+m+<span class="number">1</span>;</span><br><span class="line">  tt:=n+m+<span class="number">2</span>;</span><br><span class="line">  tota:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">read</span>(a[i]);</span><br><span class="line">    inc(tota,a[i]);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span> <span class="keyword">read</span>(b[i]);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">read</span>(t);</span><br><span class="line">    lnk[i,j]:=(t=<span class="number">1</span>);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  ll:=<span class="number">0</span>;</span><br><span class="line">  rr:=tota;</span><br><span class="line">  len:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ll+eps&lt;rr <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    mid:=(ll+rr)/<span class="number">2</span>;</span><br><span class="line">    tot:=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n+m+<span class="number">2</span> <span class="keyword">do</span> lst[i]:=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span> insert(ss,i,b[i]*mid);</span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> insert(m+i,tt,a[i]);</span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">if</span> lnk[i,j] <span class="keyword">then</span> insert(i,m+j,inf);</span><br><span class="line">    maxf:=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> bfs <span class="keyword">do</span> dfs(ss);</span><br><span class="line">    <span class="keyword">if</span> maxf+eps&gt;tota <span class="keyword">then</span> rr:=mid <span class="keyword">else</span> ll:=mid;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  writeln(ll:<span class="number">0</span>:<span class="number">4</span>);</span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;a href=&quot;http://www.lydsy.com/JudgeOnline/problem.php?id=3993&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;传送门&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;二分答案，然后网络流
      
    
    </summary>
    
      <category term="BZOJ" scheme="http://platypuspro.github.io/categories/BZOJ/"/>
    
    
      <category term="Max Flow" scheme="http://platypuspro.github.io/tags/Max-Flow/"/>
    
      <category term="Binary Divide" scheme="http://platypuspro.github.io/tags/Binary-Divide/"/>
    
  </entry>
  
  <entry>
    <title>BZOJ 3172</title>
    <link href="http://platypuspro.github.io/posts/bzoj-3172/"/>
    <id>http://platypuspro.github.io/posts/bzoj-3172/</id>
    <published>2015-06-05T03:15:06.000Z</published>
    <updated>2015-06-05T03:21:52.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=3172" target="_blank" rel="noopener">传送门</a></p><p>额…建出来SAM，然后直接统计就行了</p><p><i class="fa fa-code fa-2x"></i><br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">program</span> bzoj_3172;</span><br><span class="line"><span class="keyword">const</span> maxn=<span class="number">1000200</span>&lt;&lt;<span class="number">1</span>+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> son:<span class="keyword">array</span>[<span class="number">1</span>..maxn,<span class="number">0</span>..<span class="number">26</span>]<span class="keyword">of</span> longint;</span><br><span class="line">    fa:<span class="keyword">array</span>[<span class="number">0</span>..maxn,<span class="number">0</span>..<span class="number">20</span>]<span class="keyword">of</span> longint;</span><br><span class="line">    l,cnt,pos,seq,c:<span class="keyword">array</span>[<span class="number">0</span>..maxn]<span class="keyword">of</span> longint;</span><br><span class="line">    n,i,j,tot,p,q,np,nq,last,logn,totlen,len:longint;</span><br><span class="line">    ed:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">200</span>]<span class="keyword">of</span> longint;</span><br><span class="line">    ch:char;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">extend</span><span class="params">(c,t:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> i:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  inc(tot);</span><br><span class="line">  np:=tot;</span><br><span class="line">  p:=last;</span><br><span class="line">  last:=tot;</span><br><span class="line">  l[np]:=l[p]+<span class="number">1</span>;</span><br><span class="line">  cnt[np]:=<span class="number">1</span>;</span><br><span class="line">  pos[t]:=tot;</span><br><span class="line">  <span class="keyword">while</span> (p&lt;&gt;<span class="number">0</span>)<span class="keyword">and</span>(son[p,c]=<span class="number">0</span>) <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    son[p,c]:=np;</span><br><span class="line">    p:=fa[p,<span class="number">0</span>];</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">if</span> p=<span class="number">0</span> <span class="keyword">then</span> fa[np,<span class="number">0</span>]:=<span class="number">1</span> <span class="keyword">else</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    q:=son[p,c];</span><br><span class="line">    <span class="keyword">if</span> l[p]+<span class="number">1</span>=l[q] <span class="keyword">then</span> fa[np,<span class="number">0</span>]:=q <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      inc(tot);</span><br><span class="line">      nq:=tot;</span><br><span class="line">      l[nq]:=l[p]+<span class="number">1</span>;</span><br><span class="line">      <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> <span class="number">26</span> <span class="keyword">do</span> son[nq,i]:=son[q,i];</span><br><span class="line">      fa[nq,<span class="number">0</span>]:=fa[q,<span class="number">0</span>];</span><br><span class="line">      fa[q,<span class="number">0</span>]:=nq;</span><br><span class="line">      fa[np,<span class="number">0</span>]:=nq;</span><br><span class="line">      <span class="keyword">while</span> (p&lt;&gt;<span class="number">0</span>)<span class="keyword">and</span>(son[p,c]=q) <span class="keyword">do</span></span><br><span class="line">      <span class="keyword">begin</span></span><br><span class="line">        son[p,c]:=nq;</span><br><span class="line">        p:=fa[p,<span class="number">0</span>];</span><br><span class="line">      <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">init</span>;</span></span><br><span class="line"><span class="keyword">var</span> i:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  logn:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> <span class="number">1</span>&lt;&lt;logn&lt;=totlen <span class="keyword">do</span> inc(logn);</span><br><span class="line">  <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> logn <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> tot <span class="keyword">do</span> fa[i,j]:=fa[fa[i,j-<span class="number">1</span>],j-<span class="number">1</span>];</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">0</span> <span class="keyword">to</span> totlen <span class="keyword">do</span> c[i]:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> tot <span class="keyword">do</span> inc(c[l[i]]);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> totlen <span class="keyword">do</span> inc(c[i],c[i-<span class="number">1</span>]);</span><br><span class="line">  <span class="keyword">for</span> i:=tot <span class="keyword">downto</span> <span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    seq[c[l[i]]]:=i;</span><br><span class="line">    dec(c[l[i]]);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=tot <span class="keyword">downto</span> <span class="number">1</span> <span class="keyword">do</span> <span class="keyword">if</span> fa[seq[i],<span class="number">0</span>]&gt;<span class="number">1</span> <span class="keyword">then</span> inc(cnt[fa[seq[i],<span class="number">0</span>]],cnt[seq[i]]);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">query</span><span class="params">(st,ed:longint)</span>:</span>longint;</span><br><span class="line"><span class="keyword">var</span> i,p:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  p:=pos[ed];</span><br><span class="line">  <span class="keyword">for</span> i:=logn <span class="keyword">downto</span> <span class="number">0</span> <span class="keyword">do</span> <span class="keyword">if</span> l[fa[p,i]]&gt;=ed-st+<span class="number">1</span> <span class="keyword">then</span> p:=fa[p,i];</span><br><span class="line">  <span class="keyword">exit</span>(cnt[p]);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  readln(n);</span><br><span class="line">  tot:=<span class="number">1</span>;</span><br><span class="line">  l[<span class="number">1</span>]:=<span class="number">0</span>;</span><br><span class="line">  fa[<span class="number">1</span>,<span class="number">0</span>]:=<span class="number">0</span>;</span><br><span class="line">  last:=<span class="number">1</span>;</span><br><span class="line">  totlen:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    len:=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> eoln <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      inc(len);</span><br><span class="line">      <span class="keyword">read</span>(ch);</span><br><span class="line">      extend(ord(ch)-<span class="number">96</span>,totlen+len);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    inc(totlen,len);</span><br><span class="line">    ed[i]:=totlen;</span><br><span class="line">    <span class="keyword">if</span> i&lt;&gt;n <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      inc(totlen);</span><br><span class="line">      extend(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    readln;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  init;</span><br><span class="line">  ed[<span class="number">0</span>]:=-<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> writeln(query(ed[i-<span class="number">1</span>]+<span class="number">2</span>,ed[i]));</span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;a href=&quot;http://www.lydsy.com/JudgeOnline/problem.php?id=3172&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;传送门&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;额…建出来SAM，然
      
    
    </summary>
    
      <category term="BZOJ" scheme="http://platypuspro.github.io/categories/BZOJ/"/>
    
    
      <category term="Suffix Automaton" scheme="http://platypuspro.github.io/tags/Suffix-Automaton/"/>
    
  </entry>
  
  <entry>
    <title>BZOJ 3786</title>
    <link href="http://platypuspro.github.io/posts/bzoj-3786/"/>
    <id>http://platypuspro.github.io/posts/bzoj-3786/</id>
    <published>2015-06-03T08:42:48.000Z</published>
    <updated>2015-12-12T11:52:10.529Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=3786" target="_blank" rel="noopener">传送门</a></p><p>用$\texttt{Splay}$维护$\texttt{DFS}$序</p><p>首先，每个节点到根路径的权值和即为$\texttt{DFS}$序的前缀和</p><p>然后对$\texttt{DFS}$序中每个节点存一下权值、进栈或出栈，拿这个建棵$\texttt{Splay}$，求前缀和时直接$\texttt{Splay}$到根然后求$\texttt{Sum}$</p><p>坑的地方在于对于一个点是进栈的点还是出栈的点的判断…这个有两种方法，一种是每个点存个布尔变量判断一下，还有就是存个$-1$或$1$的数与权值相乘 <del>显然第二种比第一种不知道高到哪里去了</del></p><p>第一种方法需要进栈加出栈减，第二种方法只用直接加就行，结果拿第二种方法写的时候脑子抽了也搞成了进栈加出栈减…调了好久TAT</p><p>还有就是注意<code>int64</code></p><p><del>卡时拿了PASCAL的一血2333</del></p><p><i class="fa fa-code fa-2x"></i><br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">program</span> bzoj_3786;</span><br><span class="line"><span class="keyword">var</span> s:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">200002</span>]<span class="keyword">of</span> <span class="keyword">record</span> fa,lc,rc,f,size,cnt,k,plus:longint; sum:int64; <span class="keyword">end</span>;</span><br><span class="line">    seq,id:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">200002</span>]<span class="keyword">of</span> longint;</span><br><span class="line">    lst,w,pl,pr:<span class="keyword">array</span>[<span class="number">0</span>..<span class="number">100000</span>]<span class="keyword">of</span> longint;</span><br><span class="line">    l:<span class="keyword">array</span>[<span class="number">1</span>..<span class="number">100000</span>]<span class="keyword">of</span> <span class="keyword">record</span> ed,pre:longint; <span class="keyword">end</span>;</span><br><span class="line">    n,m,i,fa,a,b,tot,rt,len:longint;</span><br><span class="line">    c:char;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">link</span><span class="params">(a,b:longint)</span>;</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    inc(tot);</span><br><span class="line">    l[tot].pre:=lst[a];</span><br><span class="line">    lst[a]:=tot;</span><br><span class="line">    l[tot].ed:=b;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">dfs</span><span class="params">(t:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> k:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    inc(len);</span><br><span class="line">    seq[len]:=<span class="number">1</span>;</span><br><span class="line">    id[len]:=t;</span><br><span class="line">    k:=lst[t];</span><br><span class="line">    <span class="keyword">while</span> k&lt;&gt;<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        dfs(l[k].ed);</span><br><span class="line">        k:=l[k].pre;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    inc(len);</span><br><span class="line">    seq[len]:=-<span class="number">1</span>;</span><br><span class="line">    id[len]:=t;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">pushdown</span><span class="params">(t:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> l,r:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    l:=s[t].lc;</span><br><span class="line">    r:=s[t].rc;</span><br><span class="line">    <span class="keyword">if</span> l&lt;&gt;<span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        inc(s[l].plus,s[t].plus);</span><br><span class="line">        inc(s[l].sum,int64(s[t].plus)*int64(s[l].cnt));</span><br><span class="line">        inc(s[l].k,s[t].plus);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">if</span> r&lt;&gt;<span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        inc(s[r].plus,s[t].plus);</span><br><span class="line">        inc(s[r].sum,int64(s[t].plus)*int64(s[r].cnt));</span><br><span class="line">        inc(s[r].k,s[t].plus);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    s[t].plus:=<span class="number">0</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">update</span><span class="params">(t:longint)</span>;</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> t=<span class="number">0</span> <span class="keyword">then</span> <span class="keyword">exit</span>;</span><br><span class="line">    <span class="keyword">if</span> s[t].plus&lt;&gt;<span class="number">0</span> <span class="keyword">then</span> pushdown(t);</span><br><span class="line">    s[t].size:=s[s[t].lc].size+s[s[t].rc].size+<span class="number">1</span>;</span><br><span class="line">    s[t].cnt:=s[s[t].lc].cnt+s[s[t].rc].cnt+s[t].f;</span><br><span class="line">    s[t].sum:=s[s[t].lc].sum+s[s[t].rc].sum+s[t].f*s[t].k;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">build</span><span class="params">(<span class="keyword">var</span> t:longint;l,r,fa:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> mid:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    mid:=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    inc(tot);</span><br><span class="line">    t:=tot;</span><br><span class="line">    s[t].fa:=fa;</span><br><span class="line">    s[t].f:=seq[mid];</span><br><span class="line">    s[t].k:=w[id[mid]];</span><br><span class="line">    s[t].sum:=s[t].k;</span><br><span class="line">    s[t].size:=<span class="number">1</span>;</span><br><span class="line">    s[t].cnt:=s[t].f;</span><br><span class="line">    <span class="keyword">if</span> seq[mid]=<span class="number">1</span> <span class="keyword">then</span> pl[id[mid]]:=tot;</span><br><span class="line">    <span class="keyword">if</span> seq[mid]=-<span class="number">1</span> <span class="keyword">then</span> pr[id[mid]]:=tot;</span><br><span class="line">    <span class="keyword">if</span> l&lt;mid <span class="keyword">then</span> build(s[t].lc,l,mid-<span class="number">1</span>,t);</span><br><span class="line">    <span class="keyword">if</span> mid&lt;r <span class="keyword">then</span> build(s[t].rc,mid+<span class="number">1</span>,r,t);</span><br><span class="line">    update(t);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">l_rotate</span><span class="params">(t:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> p:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    p:=s[t].fa;</span><br><span class="line">    s[p].rc:=s[t].lc;</span><br><span class="line">    <span class="keyword">if</span> s[t].lc&lt;&gt;<span class="number">0</span> <span class="keyword">then</span> s[s[t].lc].fa:=p;</span><br><span class="line">    s[t].fa:=s[p].fa;</span><br><span class="line">    <span class="keyword">if</span> p=s[s[p].fa].lc <span class="keyword">then</span> s[s[p].fa].lc:=t;</span><br><span class="line">    <span class="keyword">if</span> p=s[s[p].fa].rc <span class="keyword">then</span> s[s[p].fa].rc:=t;</span><br><span class="line">    s[p].fa:=t;</span><br><span class="line">    s[t].lc:=p;</span><br><span class="line">    update(p);</span><br><span class="line">    update(t);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">r_rotate</span><span class="params">(t:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> p:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    p:=s[t].fa;</span><br><span class="line">    s[p].lc:=s[t].rc;</span><br><span class="line">    <span class="keyword">if</span> s[t].rc&lt;&gt;<span class="number">0</span> <span class="keyword">then</span> s[s[t].rc].fa:=p;</span><br><span class="line">    s[t].fa:=s[p].fa;</span><br><span class="line">    <span class="keyword">if</span> p=s[s[p].fa].lc <span class="keyword">then</span> s[s[p].fa].lc:=t;</span><br><span class="line">    <span class="keyword">if</span> p=s[s[p].fa].rc <span class="keyword">then</span> s[s[p].fa].rc:=t;</span><br><span class="line">    s[p].fa:=t;</span><br><span class="line">    s[t].rc:=p;</span><br><span class="line">    update(p);</span><br><span class="line">    update(t);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">splay</span><span class="params">(t:longint)</span>;</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">while</span> s[t].fa&lt;&gt;<span class="number">0</span> <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> s[s[t].fa].plus&lt;&gt;<span class="number">0</span> <span class="keyword">then</span> pushdown(s[t].fa);</span><br><span class="line">        <span class="keyword">if</span> s[s[s[t].fa].lc].plus&lt;&gt;<span class="number">0</span> <span class="keyword">then</span> pushdown(s[s[t].fa].lc);</span><br><span class="line">        <span class="keyword">if</span> s[s[s[t].fa].rc].plus&lt;&gt;<span class="number">0</span> <span class="keyword">then</span> pushdown(s[s[t].fa].rc);</span><br><span class="line">        <span class="keyword">if</span> t=s[s[t].fa].lc <span class="keyword">then</span> r_rotate(t) <span class="keyword">else</span> l_rotate(t);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    rt:=t;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">query</span><span class="params">(t:longint)</span>:</span>int64;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    splay(t);</span><br><span class="line">    <span class="keyword">exit</span>(s[s[t].lc].sum+s[t].f*s[t].k);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">rank</span><span class="params">(t:longint)</span>:</span>longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    splay(t);</span><br><span class="line">    <span class="keyword">exit</span>(s[s[t].lc].size+<span class="number">1</span>);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getk</span><span class="params">(t,k:longint)</span>:</span>longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> k=s[s[t].lc].size+<span class="number">1</span> <span class="keyword">then</span> <span class="keyword">exit</span>(t);</span><br><span class="line">    <span class="keyword">if</span> k&lt;=s[s[t].lc].size <span class="keyword">then</span> <span class="keyword">exit</span>(getk(s[t].lc,k))</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">exit</span>(getk(s[t].rc,k-s[s[t].lc].size-<span class="number">1</span>));</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">move</span><span class="params">(x,y:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> t,r1,r2:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    r1:=rank(pl[x])-<span class="number">1</span>;</span><br><span class="line">    r2:=rank(pr[x])+<span class="number">1</span>;</span><br><span class="line">    splay(getk(rt,r1));</span><br><span class="line">    splay(getk(rt,r2));</span><br><span class="line">    t:=s[s[rt].lc].rc;</span><br><span class="line">    s[s[rt].lc].rc:=<span class="number">0</span>;</span><br><span class="line">    update(s[rt].lc);</span><br><span class="line">    update(rt);</span><br><span class="line">    splay(getk(rt,rank(pr[y])-<span class="number">1</span>));</span><br><span class="line">    splay(pr[y]);</span><br><span class="line">    s[s[rt].lc].rc:=t;</span><br><span class="line">    s[t].fa:=s[rt].lc;</span><br><span class="line">    update(s[rt].lc);</span><br><span class="line">    update(rt);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">plus</span><span class="params">(t,d:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> r1,r2:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    r1:=rank(pl[t])-<span class="number">1</span>;</span><br><span class="line">    r2:=rank(pr[t])+<span class="number">1</span>;</span><br><span class="line">    splay(getk(rt,r1));</span><br><span class="line">    splay(getk(rt,r2));</span><br><span class="line">    t:=s[s[rt].lc].rc;</span><br><span class="line">    inc(s[t].sum,int64(d)*int64(s[t].cnt));</span><br><span class="line">    inc(s[t].plus,d);</span><br><span class="line">    inc(s[t].k,d);</span><br><span class="line">    update(s[rt].lc);</span><br><span class="line">    update(rt);</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    readln(n);</span><br><span class="line">    tot:=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">2</span> <span class="keyword">to</span> n <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">read</span>(fa);</span><br><span class="line">        link(fa,i);</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> <span class="keyword">read</span>(w[i]);</span><br><span class="line">    len:=<span class="number">1</span>;</span><br><span class="line">    dfs(<span class="number">1</span>);</span><br><span class="line">    inc(len);</span><br><span class="line">    tot:=<span class="number">0</span>;</span><br><span class="line">    build(rt,<span class="number">1</span>,len,<span class="number">0</span>);</span><br><span class="line">    readln(m);</span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> m <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">read</span>(c,a);</span><br><span class="line">        <span class="keyword">if</span> c&lt;&gt;<span class="string">'Q'</span> <span class="keyword">then</span> <span class="keyword">read</span>(b);</span><br><span class="line">        readln;</span><br><span class="line">        <span class="keyword">case</span> c <span class="keyword">of</span></span><br><span class="line">            <span class="string">'Q'</span>:writeln(query(pl[a]));</span><br><span class="line">            <span class="string">'C'</span>:move(a,b);</span><br><span class="line">            <span class="string">'F'</span>:plus(a,b);</span><br><span class="line">        <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;a href=&quot;http://www.lydsy.com/JudgeOnline/problem.php?id=3786&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;传送门&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;用$\texttt{
      
    
    </summary>
    
      <category term="BZOJ" scheme="http://platypuspro.github.io/categories/BZOJ/"/>
    
    
      <category term="Splay" scheme="http://platypuspro.github.io/tags/Splay/"/>
    
      <category term="DFS Sequence" scheme="http://platypuspro.github.io/tags/DFS-Sequence/"/>
    
  </entry>
  
  <entry>
    <title>BZOJ 3998</title>
    <link href="http://platypuspro.github.io/posts/bzoj-3998/"/>
    <id>http://platypuspro.github.io/posts/bzoj-3998/</id>
    <published>2015-05-25T13:33:47.000Z</published>
    <updated>2015-06-10T02:09:54.000Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p><a href="http://www.lydsy.com/JudgeOnline/problem.php?id=3998" target="_blank" rel="noopener">传送门</a></p><p><img src="http://i1.tietuku.com/3b96536c5f066fa2.png" alt=""><br>我就放图不说话… <del>喂，110吗？真是日了评测机了…</del></p><p>恩…首先后缀自动机是要建的吧…</p><p>设$Cnt_i$为以$i$为结尾的子串个数</p><p>然后若$T=0$，则以后缀自动机的一个节点为结尾的子串再多也只能算一个，所以$Cnt_i$全部赋为$1$</p><p>若$T=1$<br>$$Cnt_i=\sum_{fa_j=i}Cnt_j+1$$</p><p>然后统计一下经过每个节点的子串个数，设它为$Sum_i$<br>$$Sum_i=Cnt_i+\sum_{j=son_i}Cnt_j$$</p><p>然后对自动机进行一遍DFS，先挑字典序小的走，若能走就输出并继续，这样就可以了…</p><p><i class="fa fa-code fa-2x"></i><br><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">program</span> bzoj_3998;</span><br><span class="line"><span class="keyword">const</span> maxn=<span class="number">1000005</span>;</span><br><span class="line"><span class="keyword">var</span> fa,cnt,sum,l,seq,c:<span class="keyword">array</span>[<span class="number">0</span>..maxn]<span class="keyword">of</span> longint;</span><br><span class="line">    son:<span class="keyword">array</span>[<span class="number">0</span>..maxn,<span class="number">1</span>..<span class="number">26</span>]<span class="keyword">of</span> longint;</span><br><span class="line">    n,t,k,tot,last,p,q,np,nq:longint;</span><br><span class="line">    ch:char;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">insert</span><span class="params">(c:longint)</span>;</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  inc(tot);</span><br><span class="line">  np:=tot;</span><br><span class="line">  cnt[np]:=<span class="number">1</span>;</span><br><span class="line">  p:=last;</span><br><span class="line">  last:=tot;</span><br><span class="line">  l[np]:=l[p]+<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> (p&lt;&gt;<span class="number">0</span>)<span class="keyword">and</span>(son[p,c]=<span class="number">0</span>) <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    son[p,c]:=np;</span><br><span class="line">    p:=fa[p];</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">if</span> p=<span class="number">0</span> <span class="keyword">then</span> fa[np]:=<span class="number">1</span> <span class="keyword">else</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    q:=son[p,c];</span><br><span class="line">    <span class="keyword">if</span> l[p]+<span class="number">1</span>=l[q] <span class="keyword">then</span> fa[np]:=q <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      inc(tot);</span><br><span class="line">      nq:=tot;</span><br><span class="line">      son[nq]:=son[q];</span><br><span class="line">      fa[nq]:=fa[q];</span><br><span class="line">      fa[q]:=nq;</span><br><span class="line">      fa[np]:=nq;</span><br><span class="line">      l[nq]:=l[p]+<span class="number">1</span>;</span><br><span class="line">      <span class="keyword">while</span> (p&lt;&gt;<span class="number">0</span>)<span class="keyword">and</span>(son[p,c]=q) <span class="keyword">do</span></span><br><span class="line">      <span class="keyword">begin</span></span><br><span class="line">        son[p,c]:=nq;</span><br><span class="line">        p:=fa[p];</span><br><span class="line">      <span class="keyword">end</span>;</span><br><span class="line">    <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">init</span>;</span></span><br><span class="line"><span class="keyword">var</span> i,j:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> tot <span class="keyword">do</span> c[i]:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> tot <span class="keyword">do</span> inc(c[l[i]]);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> n <span class="keyword">do</span> inc(c[i],c[i-<span class="number">1</span>]);</span><br><span class="line">  <span class="keyword">for</span> i:=tot <span class="keyword">downto</span> <span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    seq[c[l[i]]]:=i;</span><br><span class="line">    dec(c[l[i]]);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=tot <span class="keyword">downto</span> <span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    p:=seq[i];</span><br><span class="line">    <span class="keyword">if</span> t=<span class="number">1</span> <span class="keyword">then</span> inc(cnt[fa[p]],cnt[p]) <span class="keyword">else</span> cnt[p]:=<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  cnt[<span class="number">1</span>]:=<span class="number">0</span>;</span><br><span class="line">  <span class="keyword">for</span> i:=tot <span class="keyword">downto</span> <span class="number">1</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    p:=seq[i];</span><br><span class="line">    sum[p]:=cnt[p];</span><br><span class="line">    <span class="keyword">for</span> j:=<span class="number">1</span> <span class="keyword">to</span> <span class="number">26</span> <span class="keyword">do</span> <span class="keyword">if</span> son[p,j]&lt;&gt;<span class="number">0</span> <span class="keyword">then</span> inc(sum[p],sum[son[p,j]]);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">procedure</span> <span class="title">dfs</span><span class="params">(t,k:longint)</span>;</span></span><br><span class="line"><span class="keyword">var</span> i:longint;</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  <span class="keyword">if</span> k&lt;=cnt[t] <span class="keyword">then</span> <span class="keyword">exit</span>;</span><br><span class="line">  dec(k,cnt[t]);</span><br><span class="line">  <span class="keyword">for</span> i:=<span class="number">1</span> <span class="keyword">to</span> <span class="number">26</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">if</span> son[t,i]&lt;&gt;<span class="number">0</span> <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> k&lt;=sum[son[t,i]] <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">      <span class="keyword">write</span>(chr(i+<span class="number">96</span>));</span><br><span class="line">      dfs(son[t,i],k);</span><br><span class="line">      <span class="keyword">exit</span>;</span><br><span class="line">    <span class="keyword">end</span> <span class="keyword">else</span> dec(k,sum[son[t,i]]);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line"><span class="keyword">end</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">  n:=<span class="number">0</span>;</span><br><span class="line">  tot:=<span class="number">1</span>;</span><br><span class="line">  last:=<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span> <span class="keyword">not</span> eoln <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">begin</span></span><br><span class="line">    inc(n);</span><br><span class="line">    <span class="keyword">read</span>(ch);</span><br><span class="line">    insert(ord(ch)-<span class="number">96</span>);</span><br><span class="line">  <span class="keyword">end</span>;</span><br><span class="line">  readln(t,k);</span><br><span class="line">  init;</span><br><span class="line">  <span class="keyword">if</span> k&gt;sum[<span class="number">1</span>] <span class="keyword">then</span> <span class="keyword">write</span>(<span class="string">'-1'</span>) <span class="keyword">else</span> dfs(<span class="number">1</span>,k);</span><br><span class="line">  writeln;</span><br><span class="line"><span class="keyword">end</span>.</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;&lt;a href=&quot;http://www.lydsy.com/JudgeOnline/problem.php?id=3998&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;传送门&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;
      
    
    </summary>
    
      <category term="BZOJ" scheme="http://platypuspro.github.io/categories/BZOJ/"/>
    
    
      <category term="Suffix Automaton" scheme="http://platypuspro.github.io/tags/Suffix-Automaton/"/>
    
  </entry>
  
</feed>
